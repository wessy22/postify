<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>×“×•"×— ×¤×¨×¡×•× ×™×•××™</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/he.js"></script>
    
    <style>
        /* ×ª×™×§×•×Ÿ Mixed Content - ×”×¡×ª×¨×ª ××œ×× ×˜×™× ×©× ×˜×¢× ×™× ×‘-HTTP */
        [src^="http://"], [href^="http://"] {
            display: none !important;
        }
        
        /* ×¡×’× ×•× ×•×ª ×‘×¡×™×¡×™×™× ×œ×¢××•×“ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
            overflow-x: hidden;
            max-width: 100%;
        }
        
        .published-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .page-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #0b2743;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .controls-section {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .date-filter {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .date-filter label {
            font-weight: bold;
            color: #0b2743;
            white-space: nowrap;
        }
        
        .date-filter input {
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .refresh-btn {
            background: #0b2743;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }
        
        .refresh-btn:hover {
            background: #1a365d;
        }
        
        .export-btn {
            background: #28a745;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }
        
        .export-btn:hover {
            background: #218838;
        }
        
        .table-view-btn {
            background: #17a2b8;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }
        
        .table-view-btn:hover {
            background: #138496;
        }
        
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #000000;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .stat-card.today {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: #000000;
        }
        
        .stat-card.total {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: #000000;
        }
        
        .stat-card.groups {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: #000000;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 1.1em;
            opacity: 0.8;
            color: #000000;
        }
        
        .loading-spinner {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #666;
        }
        
        /* ×× ×™××¦×™×•×ª ×˜×¢×™× ×” ×™×¤×•×ª */
        .loading-icon {
            font-size: 3em;
            margin-bottom: 20px;
            animation: spin 2s linear infinite, pulse 1.5s ease-in-out infinite alternate;
            display: inline-block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; transform: scale(0.95); }
            100% { opacity: 1; transform: scale(1.05); }
        }
        
        .loading-dots {
            display: inline-block;
        }
        
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0% { content: ''; }
            25% { content: '.'; }
            50% { content: '..'; }
            75% { content: '...'; }
            100% { content: ''; }
        }
        
        /* ×× ×™××¦×™×” ×œ×˜×§×¡×˜ ×”×˜×¢×™× ×” */
        .loading-text {
            animation: fadeInOut 2s ease-in-out infinite;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .loading-progress {
            background: linear-gradient(90deg, #0b2743, #1a365d, #2d5a87, #1a365d, #0b2743);
            background-size: 200% 100%;
            animation: shimmer 2s ease-in-out infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        /* ×¢×™×¦×•×‘ ×¨×©×™××” - ×©×•×¨×•×ª */
        .posts-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 20px;
        }
        
        .group-row {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 8px 12px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            transition: all 0.3s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.06);
            margin-bottom: 3px;
        }
        
        .group-row:hover {
            transform: translateY(-0.5px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            border-color: #0b2743;
        }
        
        .group-row.success {
            border-right: 3px solid #28a745;
            background: linear-gradient(to left, #f8fff9 0%, #fff 100%);
        }
        
        .group-row.failed {
            border-right: 3px solid #dc3545;
            background: linear-gradient(to left, #fff5f5 0%, #fff 100%);
        }
        
        .group-row.warning {
            border-right: 3px solid #ffc107;
            background: linear-gradient(to left, #fffcf0 0%, #fff 100%);
        }
        
        .group-row-line1 {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }
        
        .group-row-line2 {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            font-size: 1em;
            color: #666;
        }
        
        .status-icon {
            font-size: 1.3em;
            min-width: 22px;
            text-align: center;
        }
        
        .group-name {
            font-weight: bold;
            color: #0b2743;
            flex: 1;
            font-size: 1.1em;
            text-align: right;
        }
        
        .publish-time {
            color: #666;
            font-size: 1em;
            font-weight: 500;
        }
        
        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
            white-space: nowrap;
            text-align: center;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 100px;
            justify-content: center;
        }
        
        .action-btn.primary {
            background: #0b2743;
            color: white;
        }
        
        .action-btn.primary:hover {
            background: #1a365d;
            transform: translateY(-1px);
        }
        
        .action-btn.secondary {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #dee2e6;
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .no-posts {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .no-posts i {
            font-size: 4em;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }
        
        /* ×›×•×ª×¨×ª ×”×¤×•×¡×˜ */
        .post-title-header {
            background: linear-gradient(135deg, #0b2743 0%, #1a365d 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .post-title-header h2 {
            margin: 0;
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .post-title-header .post-subtitle {
            margin-top: 5px;
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 0;
                overflow-x: hidden;
            }
            .published-container {
                padding: 8px;
                border-radius: 0;
                box-shadow: none;
                max-width: 100%;
                width: 100%;
                box-sizing: border-box;
            }
            .header-section {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
                margin-bottom: 18px;
            }
            .controls-section {
                flex-direction: column;
                gap: 8px;
                align-items: stretch;
                justify-content: center;
            }
            .date-filter {
                flex-direction: column;
                text-align: center;
                gap: 4px;
                padding: 8px;
                border-radius: 6px;
                font-size: 1em;
            }
            .date-filter label {
                font-size: 1em;
            }
            .date-filter input {
                font-size: 1em;
                padding: 6px 8px;
                background: #fff;
                transition: border 0.2s, background 0.2s;
            }
            .date-filter input:focus, .date-filter input:active {
                border: 2px solid #0b2743;
                background: #eaf2fb;
            }
            .refresh-btn {
                width: 100%;
                padding: 10px 0;
                font-size: 1em;
            }
            .export-btn {
                width: 100%;
                padding: 10px 0;
                font-size: 1em;
            }
            .table-view-btn {
                width: 100%;
                padding: 10px 0;
                font-size: 1em;
            }
            .stats-section {
                grid-template-columns: 1fr;
                gap: 10px;
                margin-bottom: 18px;
            }
            .stat-card {
                padding: 12px;
                font-size: 1em;
            }
            .stat-number {
                font-size: 1.5em;
            }
            .stat-label {
                font-size: 1em;
            }
            .post-title-header {
                padding: 12px;
                font-size: 1em;
            }
            .post-title-header h2 {
                font-size: 1.1em;
            }
            .post-title-header .post-subtitle {
                font-size: 1em;
                max-width: 100%;
                overflow: hidden;
                word-wrap: break-word;
                white-space: normal;
            }
            .table-header {
                display: none;
            }
            .group-row {
                padding: 8px 10px;
                font-size: 1em;
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
                margin-bottom: 4px;
            }
            .group-row .group-name {
                font-size: 1em;
            }
            .group-row-line1, .group-row-line2 {
                gap: 8px;
            }
            .action-btn {
                min-width: 120px;
                width: 100%;
                font-size: 1em;
                padding: 12px 20px;
            }
            .error-message {
                font-size: 1em;
                padding: 10px;
            }
            .no-posts {
                padding: 30px 8px;
                font-size: 1em;
            }
            .loading-spinner {
                padding: 30px 8px;
                font-size: 1em;
            }
            #posts-container {
                overflow-x: hidden;
                padding-bottom: 10px;
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
            }
        }
        
        @media (max-width: 480px) {
            .published-container {
                padding: 4px;
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
            }
            .stat-number {
                font-size: 1.1em;
            }
            .group-row {
                padding: 6px 8px;
                font-size: 0.9em;
            }
            .post-title-header {
                padding: 7px;
                font-size: 0.95em;
            }
            .action-btn {
                font-size: 0.9em;
                padding: 10px 16px;
                min-width: 100px;
            }
            .error-message {
                font-size: 0.95em;
                padding: 7px;
            }
            .no-posts {
                padding: 18px 4px;
                font-size: 0.95em;
            }
            .loading-spinner {
                padding: 18px 4px;
                font-size: 0.95em;
            }
            .stats-section {
                grid-template-columns: 1fr;
            }
            
            /* ×¨×¡×¤×•× ×¡×™×‘×™×•×ª ×œ×¤×•×¤××¤ ×™×™×¦×•× */
            .export-dialog {
                padding: 20px;
                max-width: 95%;
            }
            
            .export-header {
                font-size: 1.2em;
            }
            
            .export-option {
                padding: 12px;
                font-size: 1em;
            }
            
            .date-range-inputs {
                flex-direction: column;
            }
            
            .export-actions {
                flex-direction: column;
            }
            
            .export-action-btn {
                width: 100%;
                margin-bottom: 10px;
            }
            
            /* ×¨×¡×¤×•× ×¡×™×‘×™×•×ª ×œ×˜×‘×œ×” */
            .table-dialog {
                max-width: 98%;
                max-height: 95%;
                padding: 15px;
            }
            
            .table-filters {
                flex-direction: column;
                gap: 10px;
            }
            
            .filter-group {
                width: 100%;
            }
            
            .filter-group input,
            .filter-group select {
                width: 100%;
                min-width: auto;
            }
            
            .data-table {
                font-size: 0.8em;
            }
            
            .data-table th,
            .data-table td {
                padding: 6px 4px;
            }
            
            .table-stats {
                font-size: 0.9em;
            }
        }
        
        /* ×× ×™××¦×™×•×ª */
        .group-row {
            animation: fadeInUp 0.3s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .action-btn {
            position: relative;
            overflow: hidden;
        }
        
        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .action-btn:hover::before {
            left: 100%;
        }
        
        /* ××¤×§×˜ ×–×‘×¨×” ×œ×©×•×¨×•×ª */
        .group-row:nth-child(even) {
            background: #fafafa;
        }
        
        .group-row:nth-child(even):hover {
            background: #fff;
        }
        
        .group-row:nth-child(even).success {
            background: linear-gradient(to left, #f8fff9 0%, #fafafa 100%);
        }
        
        .group-row:nth-child(even).failed {
            background: linear-gradient(to left, #fff5f5 0%, #fafafa 100%);
        }
        
        .group-row:nth-child(even).warning {
            background: linear-gradient(to left, #fffcf0 0%, #fafafa 100%);
        }
        
        /* ×©×™×¤×•×¨ CSS ×œ××•×˜×•×¡×§×¨×•×œ×™×Ÿ: ×”×•×¡×¤×ª width: fit-content ×•-rtl */
        .autoslide-text {
            display: inline-block;
            vertical-align: middle;
            will-change: transform;
            width: fit-content;
            direction: rtl;
            white-space: nowrap;
            transition: transform 0.3s ease;
        }
        
        .post-title-header .post-subtitle {
            margin-top: 5px;
            font-size: 0.9em;
            opacity: 0.8;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }
        
        .post-title-header .post-subtitle:hover .autoslide-text {
            animation-play-state: running;
        }
        
        /* ×¡×’× ×•× ×•×ª ×¤×•×¤××¤ ×™×™×¦×•× */
        .export-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .export-dialog {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: fadeInScale 0.3s ease-out;
            direction: rtl;
        }
        
        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .export-header {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.5em;
            font-weight: bold;
            color: #0b2743;
        }
        
        .export-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .export-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }
        
        .export-option:hover {
            border-color: #0b2743;
            background: #f8f9fa;
        }
        
        .export-option.selected {
            border-color: #28a745;
            background: #e8f5e8;
        }
        
        .export-option input[type="radio"] {
            margin-left: 8px;
            transform: scale(1.2);
        }
        
        .date-range-inputs {
            display: none;
            gap: 10px;
            margin-top: 10px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .date-range-inputs.show {
            display: flex;
        }
        
        .date-range-inputs label {
            font-weight: bold;
            margin-left: 5px;
        }
        
        .date-range-inputs input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }
        
        .export-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .export-action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 120px;
        }
        
        .export-confirm {
            background: #28a745;
            color: white;
        }
        
        .export-confirm:hover {
            background: #218838;
        }
        
        .export-cancel {
            background: #6c757d;
            color: white;
        }
        
        .export-cancel:hover {
            background: #5a6268;
        }
        
        .export-loading {
            display: none;
            text-align: center;
            padding: 20px;
            font-size: 1.1em;
            color: #666;
        }
        
        .export-loading-icon {
            font-size: 2em;
            margin-bottom: 10px;
            animation: spin 1s linear infinite;
        }
        
        /* ×¡×’× ×•× ×•×ª ×˜×‘×œ×” ××¡×•×“×¨×ª */
        .table-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            backdrop-filter: blur(3px);
        }
        
        .table-dialog {
            background: white;
            border-radius: 15px;
            padding: 20px;
            max-width: 95%;
            width: 1200px;
            max-height: 90%;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: fadeInScale 0.3s ease-out;
            direction: rtl;
            display: flex;
            flex-direction: column;
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #0b2743;
        }
        
        .table-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #0b2743;
            margin: 0;
        }
        
        .table-close-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .table-close-btn:hover {
            background: #c82333;
        }
        
        .table-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-group label {
            font-weight: bold;
            color: #0b2743;
            font-size: 0.9em;
        }
        
        .filter-group input, .filter-group select {
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 0.9em;
            min-width: 120px;
        }
        
        .clear-filters-btn {
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            font-size: 0.9em;
            cursor: pointer;
            transition: background 0.2s;
            align-self: flex-end;
        }
        
        .clear-filters-btn:hover {
            background: #5a6268;
        }
        
        .table-container {
            flex: 1;
            overflow: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
            background: white;
        }
        
        .data-table th {
            background: linear-gradient(135deg, #0b2743 0%, #1a365d 100%);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 2px solid #0b2743;
        }
        
        .data-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #eee;
            text-align: center;
            vertical-align: middle;
        }
        
        .data-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .data-table tbody tr:nth-child(even) {
            background: #fafafa;
        }
        
        .data-table tbody tr:nth-child(even):hover {
            background: #f0f0f0;
        }
        
        .date-separator {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%) !important;
            color: white !important;
            font-weight: bold !important;
            text-align: center !important;
            font-size: 1.1em !important;
        }
        
        .date-separator td {
            padding: 15px !important;
        }
        
        .table-link {
            color: #0b2743;
            text-decoration: none;
            font-weight: bold;
        }
        
        .table-link:hover {
            color: #1a365d;
            text-decoration: underline;
        }
        
        .status-success-table {
            background: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .status-failed-table {
            background: #f8d7da;
            color: #721c24;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .table-stats {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            color: #0b2743;
        }
    </style>
</head>
<body>

<script>
// ×ª×™×§×•×Ÿ Mixed Content ×‘×××¦×¢×•×ª JavaScript
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ”§ Starting Mixed Content fixes for published posts list...');
    
    function fixElement(element, attribute) {
        const originalValue = element[attribute];
        if (originalValue && originalValue.startsWith('http://')) {
            const newValue = originalValue.replace('http://', 'https://');
            element[attribute] = newValue;
            console.log(`âœ… Fixed ${attribute}:`, originalValue, 'â†’', newValue);
            return true;
        }
        return false;
    }
    
    function fixExistingElements() {
        let fixedCount = 0;
        
        document.querySelectorAll('link[href^="http://"]').forEach(link => {
            if (fixElement(link, 'href')) fixedCount++;
        });
        
        document.querySelectorAll('script[src^="http://"]').forEach(script => {
            if (fixElement(script, 'src')) fixedCount++;
        });
        
        document.querySelectorAll('img[src^="http://"]').forEach(img => {
            if (fixElement(img, 'src')) fixedCount++;
        });
        
        document.querySelectorAll('[src^="http://"], [href^="http://"]').forEach(element => {
            ['src', 'href'].forEach(attr => {
                if (element[attr]) fixElement(element, attr);
            });
        });
        
        if (fixedCount > 0) {
            console.log(`ğŸ¯ Fixed ${fixedCount} HTTP elements to HTTPS`);
        }
    }
    
    fixExistingElements();
    setInterval(fixExistingElements, 3000);
    
    window.addEventListener('error', function(e) {
        if (e.target && e.target.src && e.target.src.startsWith('http://')) {
            console.warn('âš ï¸ Mixed Content blocked, attempting fix:', e.target.src);
            fixElement(e.target, 'src');
        }
    }, true);
    
    console.log('âœ… Mixed Content protection active for published posts list');
});

// ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
let publishedPosts = [];
let allWeeklyPosts = [];
let allMonthlyPosts = [];
let currentDate = new Date().toISOString().split('T')[0];
let hostname = "";
let isPreloadComplete = false;
let preloadPromise = null;

// ×§××© ×œ× ×ª×•× ×™×
let dataCache = {
    posts: new Map(), // ×ª××¨×™×š -> ×¤×¨×¡×•××™×
    weekly: null,
    monthly: null,
    lastUpdate: null,
    cacheExpiry: 10 * 60 * 1000, // 10 ×“×§×•×ª
    preloadInProgress: false
};

// ×¤×•× ×§×¦×™×” ×œ×˜×¢×™× ×” ××•×§×“××ª ×©×œ ×›×œ ×”× ×ª×•× ×™× ×‘×¨×§×¢
async function preloadAllData() {
    if (dataCache.preloadInProgress || isPreloadComplete) {
        return preloadPromise;
    }
    
    console.log('ğŸš€ ××ª×—×™×œ ×˜×¢×™× ×” ××•×§×“××ª ×©×œ × ×ª×•× ×™× ×‘×¨×§×¢...');
    dataCache.preloadInProgress = true;
    
    preloadPromise = (async () => {
        try {
            updateLoadingMessage('×˜×•×¢×Ÿ × ×ª×•× ×™× ×‘×¨×§×¢...', '××›×™×Ÿ ××ª ×”×“×£ ×œ×§×•×‘×¥ ××”×™×¨');
            
            // ×˜×¢×Ÿ ××§×‘×™×œ ×©×œ ×›×œ ×”× ×ª×•× ×™× ×”×“×¨×•×©×™×
            const [todayPosts, weeklyData, monthlyData] = await Promise.all([
                loadSingleDateData(currentDate),
                loadWeeklyDataSmart(),
                loadMonthlyDataSmart()
            ]);
            
            // ×©××•×¨ ×‘×–×™×›×¨×•×Ÿ
            publishedPosts = todayPosts;
            allWeeklyPosts = weeklyData;
            allMonthlyPosts = monthlyData;
            
            // ×©××•×¨ ×‘×§××©
            dataCache.weekly = weeklyData;
            dataCache.monthly = monthlyData;
            dataCache.lastUpdate = Date.now();
            
            isPreloadComplete = true;
            console.log('âœ… ×˜×¢×™× ×” ××•×§×“××ª ×”×•×©×œ××”!', {
                today: todayPosts.length,
                weekly: weeklyData.length,
                monthly: monthlyData.length
            });
            
            return true;
        } catch (error) {
            console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×” ××•×§×“××ª:', error);
            dataCache.preloadInProgress = false;
            throw error;
        }
    })();
    
    return preloadPromise;
}

// ×¤×•× ×§×¦×™×” ×—×›××” ×œ×˜×¢×™× ×ª × ×ª×•× ×™ ×™×•× ×‘×•×“×“
async function loadSingleDateData(date) {
    const userId = getCurrentUserId();
    let apiUrl = `/wp-content/postify-api/get-published-posts.php?hostname=${encodeURIComponent(hostname)}&date=${encodeURIComponent(date)}`;
    if (userId) {
        apiUrl += `&user_id=${encodeURIComponent(userId)}`;
    }
    
    try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        const posts = data.success ? (data.posts || []) : [];
        saveToCache(date, posts);
        return posts;
    } catch (error) {
        console.warn(`âš ï¸ ×©×’×™××” ×‘×˜×¢×™× ×ª ${date}:`, error);
        return [];
    }
}

// ×˜×•×¢×Ÿ hostname ×•××ª×—×™×œ ×˜×¢×™× ×” ××”×™×¨×” ×©×œ ×”×™×•× ×‘×œ×‘×“, ×•××– ×‘×¨×§×¢ ××ª ×›×œ ×”×—×•×“×©
fetch('/wp-content/postify-api/get-hostname.php')
    .then(res => res.text())
    .then(h => {
        hostname = h.trim();
        console.log('hostname:', hostname);
        // ×˜×¢×Ÿ ×¨×§ ××ª ×”×™×•× ×§×•×“×
        loadSingleDateData(currentDate).then(posts => {
            publishedPosts = posts;
            renderPublishedPosts();
            updateStats();
            // ×”×¦×’ ×”×•×“×¢×” ×œ×˜×¢×™× ×ª ×”×—×•×“×©
            let monthLoadingMsg = document.createElement('div');
            monthLoadingMsg.id = 'month-loading-msg';
            monthLoadingMsg.style = 'text-align:center;padding:12px;color:#0b2743;font-weight:bold;';
            monthLoadingMsg.innerHTML = 'â³ ×˜×•×¢×Ÿ ××ª ×›×œ × ×ª×•× ×™ ×”×—×•×“×©...';
            document.getElementById('posts-container').prepend(monthLoadingMsg);
            // ×˜×¢×Ÿ ××ª ×›×œ ×”×—×•×“×© ×‘×¨×§×¢
            loadMonthlyDataSmart().then(monthlyData => {
                allMonthlyPosts = monthlyData;
                // ×¢×“×›×Ÿ ×ª×¦×•×’×” ×‘×œ×™×™×‘ (×× ×¦×¨×™×š)
                renderPublishedPosts();
                updateStats();
                // ×”×¡×¨ ××ª ×”×•×“×¢×ª ×”×˜×¢×™× ×”
                const msg = document.getElementById('month-loading-msg');
                if (msg) msg.remove();
            });
        });
    })
    .catch(err => {
        console.error('Error loading hostname:', err);
        hostname = 'default-client';
    });

// ×¤×•× ×§×¦×™×” ×œ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×”×§××©
function isCacheValid() {
    if (!dataCache.lastUpdate) return false;
    return (Date.now() - dataCache.lastUpdate) < dataCache.cacheExpiry;
}

// ×¤×•× ×§×¦×™×” ×œ×˜×¢×™× ×ª × ×ª×•× ×™× ××”×§××©
function getFromCache(date) {
    if (!isCacheValid()) {
        console.log('ğŸ’¾ ×§××© ×œ× ×ª×§×™×Ÿ, ×™× ×•×§×”');
        clearCache();
        return null;
    }
    return dataCache.posts.get(date) || null;
}

// ×¤×•× ×§×¦×™×” ×œ×©××™×¨×” ×‘×§××©
function saveToCache(date, posts) {
    dataCache.posts.set(date, posts);
    dataCache.lastUpdate = Date.now();
    console.log('ğŸ’¾ × ×©××¨ ×‘×§××©:', date, posts.length, '×¤×¨×¡×•××™×');
}

// ×¤×•× ×§×¦×™×” ×œ× ×™×§×•×™ ×”×§××©
function clearCache() {
    dataCache.posts.clear();
    dataCache.weekly = null;
    dataCache.monthly = null;
    dataCache.lastUpdate = null;
}

// ×¤×•× ×§×¦×™×” ×œ×¢×“×›×•×Ÿ ×”×•×“×¢×ª ×”×˜×¢×™× ×” ×¢× ×× ×™××¦×™×•×ª
function updateLoadingMessage(message, details = '') {
    const loadingText = document.getElementById('loading-text');
    const loadingDetails = document.getElementById('loading-details');
    const loadingIcon = document.querySelector('.loading-icon');
    
    if (loadingText) {
        loadingText.innerHTML = message + '<span class="loading-dots"></span>';
    }
    if (loadingDetails) {
        loadingDetails.textContent = details;
    }
    
    // ×©× ×” ××ª ×”××™×§×•×Ÿ ×œ×¤×™ ×¡×•×’ ×”×˜×¢×™× ×”
    if (loadingIcon) {
        if (message.includes('×©×‘×•×¢×™')) {
            loadingIcon.textContent = 'ğŸ“Š';
        } else if (message.includes('×—×•×“×©×™')) {
            loadingIcon.textContent = 'ğŸ“ˆ';
        } else if (message.includes('×‘×¨×§×¢')) {
            loadingIcon.textContent = 'ğŸš€';
        } else if (message.includes('××¦×™×’')) {
            loadingIcon.textContent = 'âœ¨';
        } else {
            loadingIcon.textContent = 'â³';
        }
    }
}

// ×¤×•× ×§×¦×™×” ×—×›××” ×œ×˜×¢×™× ×ª × ×ª×•× ×™ ×©×‘×•×¢ ×•×—×•×“×© ×¢× ×§××© - ×¨×§ ×¤×¢× ××—×ª!
async function loadWeeklyAndMonthlyDataWithCache() {
    // ×× ×›×‘×¨ ×˜×¢× ×• ×¤×¢× ××—×ª ×•×¢×“×™×™×Ÿ ×ª×§×™×Ÿ - ××œ ×ª×˜×¢×Ÿ ×©×•×‘!
    if (dataCache.weekly && dataCache.monthly && isCacheValid()) {
        console.log('ğŸ’¾ × ×ª×•× ×™× ×©×‘×•×¢×™×™× ×•×—×•×“×©×™×™× ×›×‘×¨ ×§×™×™××™× - ××©×ª××© ×‘×§×™×™×');
        allWeeklyPosts = dataCache.weekly;
        allMonthlyPosts = dataCache.monthly;
        return;
    }
    
    console.log('ğŸ”„ ×˜×•×¢×Ÿ × ×ª×•× ×™× ×©×‘×•×¢×™×™× ×•×—×•×“×©×™×™× ×¤×¢× ××—×ª...');
    
    // ×˜×¢×Ÿ ×‘××§×‘×™×œ ×¨×§ ×× ×¢×“×™×™×Ÿ ×œ× ×§×™×™×
    const promises = [];
    
    if (!dataCache.weekly || !isCacheValid()) {
        updateLoadingMessage('×˜×•×¢×Ÿ ×¡×˜×˜×™×¡×˜×™×§×ª ×”×©×‘×•×¢', '×¨×§ ×¢×•×“ ×¨×’×¢ - ×”× ×ª×•× ×™× ××•×›× ×™× ×›××¢×˜!');
        promises.push(loadWeeklyData().then(data => {
            allWeeklyPosts = data;
            dataCache.weekly = data;
            console.log('ğŸ“Š × ×ª×•× ×™× ×©×‘×•×¢×™×™× × ×˜×¢× ×•:', data.length);
            return data;
        }));
    } else {
        allWeeklyPosts = dataCache.weekly;
        promises.push(Promise.resolve(dataCache.weekly));
    }
    
    if (!dataCache.monthly || !isCacheValid()) {
        updateLoadingMessage('×˜×•×¢×Ÿ ×¡×˜×˜×™×¡×˜×™×§×ª ×”×—×•×“×©', 'ğŸ’ª ×˜×•×¢×Ÿ × ×ª×•× ×™× ×—×©×•×‘×™× - ×©×•×•×” ××ª ×”×”××ª× ×”!');
        promises.push(loadMonthlyData().then(data => {
            allMonthlyPosts = data;
            dataCache.monthly = data;
            console.log('ï¿½ × ×ª×•× ×™× ×—×•×“×©×™×™× × ×˜×¢× ×•:', data.length);
            return data;
        }));
    } else {
        allMonthlyPosts = dataCache.monthly;
        promises.push(Promise.resolve(dataCache.monthly));
    }
    
    await Promise.all(promises);
    dataCache.lastUpdate = Date.now();
    
    console.log('âœ… × ×ª×•× ×™× ×©×‘×•×¢×™×™× ×•×—×•×“×©×™×™× ××•×›× ×™× - ×œ× ×™×˜×¢× ×• ×©×•×‘!');
}

// ×¤×•× ×§×¦×™×” ×—×›××” ×œ×˜×¢×™× ×ª ×©×‘×•×¢ (××•×¤×˜×™××™×–×¦×™×” ××§×¡)
async function loadWeeklyDataSmart() {
    const userId = getCurrentUserId();
    const today = new Date();
    const startOfWeek = new Date(today);
    const dayOfWeek = today.getDay();
    startOfWeek.setDate(today.getDate() - dayOfWeek);
    
    const weekDates = [];
    for (let i = 0; i <= dayOfWeek; i++) {
        const date = new Date(startOfWeek);
        date.setDate(startOfWeek.getDate() + i);
        weekDates.push(date.toISOString().split('T')[0]);
    }
    
    console.log('ğŸ“… ×˜×•×¢×Ÿ ×©×‘×•×¢ ××”×™×¨:', weekDates);
    updateLoadingMessage('×˜×•×¢×Ÿ × ×ª×•× ×™ ×”×©×‘×•×¢', `ğŸ“Š ${weekDates.length} ×™××™× - ×˜×•×¢×Ÿ ×‘××”×™×¨×•×ª ××§×¡×™××œ×™×ª!`);
    
    const promises = weekDates.map(date => loadSingleDateData(date));
    const results = await Promise.all(promises);
    return results.flat();
}

// ×¤×•× ×§×¦×™×” ×—×›××” ×œ×˜×¢×™× ×ª ×—×•×“×© (××•×¤×˜×™××™×–×¦×™×” ××§×¡)
async function loadMonthlyDataSmart() {
    const userId = getCurrentUserId();
    const today = new Date();
    const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
    
    const monthDates = [];
    const currentDate = new Date(startOfMonth);
    while (currentDate <= today) {
        monthDates.push(currentDate.toISOString().split('T')[0]);
        currentDate.setDate(currentDate.getDate() + 1);
    }
    
    console.log('ğŸ“… ×˜×•×¢×Ÿ ×—×•×“×© ××”×™×¨:', monthDates.length, '×™××™×');
    updateLoadingMessage('×˜×•×¢×Ÿ × ×ª×•× ×™ ×”×—×•×“×©', `ğŸ“ˆ ${monthDates.length} ×™××™× - ×›××¢×˜ ×¡×™×™×× ×•!`);
    
    // ×‘×§×‘×•×¦×•×ª ×©×œ 10 ×œ××”×™×¨×•×ª ××§×¡×™××œ×™×ª
    const batchSize = 10;
    const allResults = [];
    
    for (let i = 0; i < monthDates.length; i += batchSize) {
        const batch = monthDates.slice(i, i + batchSize);
        const promises = batch.map(date => loadSingleDateData(date));
        const results = await Promise.all(promises);
        allResults.push(...results);
        
        updateLoadingMessage('×˜×•×¢×Ÿ × ×ª×•× ×™ ×”×—×•×“×©', `ğŸš€ ${i + batch.length}/${monthDates.length} ×™××™× - ××ª×§×“××™× ××”×¨!`);
        
        // ×”××ª× ×” ×§×¦×¨×” ×›×“×™ ×œ× ×œ×§×¨×•×¡ ××ª ×”×©×¨×ª
        if (i + batchSize < monthDates.length) {
            await new Promise(resolve => setTimeout(resolve, 50));
        }
    }
    
    return allResults.flat();
}

// ×¤×•× ×§×¦×™×” ×œ×˜×¢×™× ×ª ×”×¤×¨×¡×•××™× ××’×•×’×œ ×©×™×˜×¡ (××•×¤×˜×™××™×–×¦×™×” ×—×›××” - ×˜×¢×™× ×” ×¤×¢× ××—×ª)
async function loadPublishedPosts(filterDate = null) {
    const loadingElement = document.getElementById('loading');
    const postsContainer = document.getElementById('posts-container');
    const errorContainer = document.getElementById('error-container');
    if (loadingElement) loadingElement.style.display = 'block';
    if (errorContainer) errorContainer.style.display = 'none';
    // ×”×¡×ª×¨×ª ×”×˜×‘×œ×” ×”×§×™×™××ª ×‘×–××Ÿ ×”×˜×¢×™× ×”
    if (postsContainer) postsContainer.style.display = 'none';
    try {
        console.log('ğŸ” Loading published posts for:', hostname, 'Date filter:', filterDate);
        
        // ×˜×¢×Ÿ ××ª ×”×¤×¨×¡×•××™× ×©×œ ×”×ª××¨×™×š ×”×¡×¤×¦×™×¤×™
        let apiUrl = `/wp-content/postify-api/get-published-posts.php?hostname=${encodeURIComponent(hostname)}`;
        if (filterDate) {
            apiUrl += `&date=${encodeURIComponent(filterDate)}`;
        }
        const userId = getCurrentUserId();
        if (userId) {
            apiUrl += `&user_id=${encodeURIComponent(userId)}`;
        }
        console.log('ğŸ”— API URL:', apiUrl);
        const response = await fetch(apiUrl);
        const data = await response.json();
        console.log('ğŸ“¡ Raw API response:', data);
        
        // ×˜×¢×Ÿ ××ª ×›×œ ×”×¤×¨×¡×•××™× (×œ×œ× ×¤×™×œ×˜×¨ ×ª××¨×™×š) ×œ×¡×˜×˜×™×¡×˜×™×§×” ×”×©×‘×•×¢×™×ª
        let allPostsApiUrl = `/wp-content/postify-api/get-published-posts.php?hostname=${encodeURIComponent(hostname)}`;
        if (userId) {
            allPostsApiUrl += `&user_id=${encodeURIComponent(userId)}`;
        }
        console.log('ï¿½ All posts API URL:', allPostsApiUrl);
        
        const allPostsResponse = await fetch(allPostsApiUrl);
        const allPostsData = await allPostsResponse.json();
        console.log('ğŸ“Š All posts API response:', allPostsData);
        
        if (data.success) {
            publishedPosts = data.posts || [];
            
            // ×˜×¢×Ÿ ××ª ×”× ×ª×•× ×™× ×”×©×‘×•×¢×™×™× ×•×”×—×•×“×©×™×™× ×¨×§ ×× ×¢×“×™×™×Ÿ ×œ× ×§×™×™××™×
            await loadWeeklyAndMonthlyDataWithCache();
            
            console.log(`ğŸ“ ×¤×¨×¡×•××™× ×œ×ª××¨×™×š ${filterDate || '×”×™×•×'}:`, publishedPosts.length);
            console.log('ğŸ“Š ×¡×”"×› ×¤×¨×¡×•××™× ×©×‘×•×¢×™×™×:', allWeeklyPosts.length);
            console.log('ğŸ“Š ×¡×”"×› ×¤×¨×¡×•××™× ×—×•×“×©×™×™×:', allMonthlyPosts.length);
            
            // ×©××•×¨ ××ª posts_today ××”-API
            window.postsTodayCountFromApi = data.posts_today || 0;
            renderPublishedPosts();
            updateStats();
            // ×”×¦×’×ª ×”×˜×‘×œ×” ×‘×—×–×¨×” ×œ××—×¨ ×”×˜×¢×™× ×”
            if (postsContainer) postsContainer.style.display = 'block';
        } else {
            // ×”×¦×’×ª ×”×˜×‘×œ×” ×‘×—×–×¨×” ×’× ×‘××§×¨×” ×©×œ ×©×’×™××”
            if (postsContainer) postsContainer.style.display = 'block';
            throw new Error(data.error || 'Failed to load published posts');
        }
    } catch (error) {
        console.error('âŒ Error loading published posts:', error);
        // ×”×¦×’×ª ×”×˜×‘×œ×” ×‘×—×–×¨×” ×’× ×‘××§×¨×” ×©×œ ×©×’×™××”
        if (postsContainer) postsContainer.style.display = 'block';
        showError('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¤×¨×¡×•××™×: ' + error.message);
    } finally {
        if (loadingElement) loadingElement.style.display = 'none';
    }
}

// ×¤×•× ×§×¦×™×” ×œ×§×‘×œ×ª user ID × ×•×›×—×™
function getCurrentUserId() {
    return localStorage.getItem('user_id') || null;
}

// ×¤×•× ×§×¦×™×” ×œ×”×¦×’×ª ×©×’×™××”
function showError(message) {
    const errorContainer = document.getElementById('error-container');
    if (errorContainer) {
        errorContainer.innerHTML = `
            <div class="error-message">
                <strong>âš ï¸ ×©×’×™××”:</strong> ${message}
                <br><small>× ×¡×” ×œ×¨×¢× ×Ÿ ××ª ×”×“×£ ××• ×‘×“×•×§ ××ª ×”×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜</small>
            </div>
        `;
        errorContainer.style.display = 'block';
    }
}

// ×¤×•× ×§×¦×™×” ×œ×¨×™× ×“×•×¨ ×”×¤×¨×¡×•××™×
function renderPublishedPosts() {
    const postsContainer = document.getElementById('posts-container');
    if (!publishedPosts || publishedPosts.length === 0) {
        postsContainer.innerHTML = `
            <div class="no-posts">
                <div style="font-size: 4em; color: #ddd; margin-bottom: 20px;">ğŸ“</div>
                <h3>××™×Ÿ ×¤×¨×¡×•××™× ×œ×”×¦×’×”</h3>
                <p>×œ× × ××¦××• ×¤×¨×¡×•××™× ×‘×ª××¨×™×š ×©× ×‘×—×¨.<br>× ×¡×” ×œ×‘×—×•×¨ ×ª××¨×™×š ××—×¨ ××• ×‘×“×•×§ ×©×”×¤×¨×¡×•××™× × ×©××¨×• ×‘×’×•×’×œ ×©×™×˜×¡.</p>
            </div>
        `;
        return;
    }

    // ×§×™×‘×•×¥ ×œ×¤×™ ×©× ×¤×•×¡×˜ (×¢××•×“×” F/×©×“×” postName)
    const postsByName = {};
    publishedPosts.forEach(post => {
        // × ×¡×” ×œ××¦×•× ××ª ×©× ×”×¤×•×¡×˜ ××”×¢××•×“×” F ××• ××”×©×“×” ×”××ª××™×
        const postName = post.postName || post.F || post.postTitle || post.title || '×¤×•×¡×˜ ×œ×œ× ×©×';
        if (!postsByName[postName]) postsByName[postName] = [];
        if (post.groups && post.groups.length > 0) {
            post.groups.forEach(group => {
                postsByName[postName].push({ ...group, post });
            });
        }
    });

    // ×™×¦×™×¨×ª HTML: ×›×•×ª×¨×ª ×œ×›×œ ×¤×•×¡×˜, ×•××ª×—×ª×™×” ×˜×‘×œ×ª ×§×‘×•×¦×•×ª/×¤×¨×¡×•××™×
    let html = '';
    Object.keys(postsByName).forEach(postName => {
        html += `<div class="post-title-header"><h2>${escapeHtml(postName)}</h2></div>`;
        html += `<div class="posts-list">`;
        postsByName[postName].forEach(group => {
            html += createGroupRowHtml(group); // ×”×©×ª××© ×‘×¤×•× ×§×¦×™×” ×”×§×™×™××ª ×©×œ×š
        });
        html += `</div>`;
    });
    postsContainer.innerHTML = html;
}

// ×¤×•× ×§×¦×™×” ×œ×™×¦×™×¨×ª HTML ×œ×©×•×¨×ª ×§×‘×•×¦×”
function createGroupRowHtml(group) {
    const post = group.post;
    const status = getGroupStatus(group);
    const hasUrl = group.url && group.url !== '#' && group.url !== '';
    
    // ×”×©×¢×” - ×¨×§ ××” ×©×¨×©×•× ×‘×§×‘×•×¦×” ××• ×‘×¤×•×¡×˜ (×‘×¤×•×¨××˜ ×©×¢×•×ª:×“×§×•×ª)
    const rawTime = group.publishTime || post.publishTime || '×œ× ×–××™×Ÿ';
    const publishTime = formatTimeDisplay(rawTime);
    
    // ×¤×•× ×§×¦×™×” ×œ× ×™×§×•×™ ×©× ×”×§×‘×•×¦×” (××§×•××™×ª ×œ×¤×•× ×§×¦×™×” ×–×•)
    function cleanGroupNameDisplay(name) {
        if (!name) return '';
        
        // ×”×¡×¨ ××¡×¤×¨×™× ×‘×¡×•×’×¨×™×™×
        let cleaned = name.replace(/\s*\(\d+\)\s*/g, '').trim();
        
        // ×”×¡×¨ ××ª ×”××™×œ×” "facebook" ××”×¡×•×£ ××• ××”×”×ª×—×œ×” (case insensitive)
        cleaned = cleaned.replace(/\s*facebook\s*$/i, '').trim();
        cleaned = cleaned.replace(/^facebook\s*/i, '').trim();
        
        // ×”×¡×¨ ×ª×•×•×™× ××™×•×—×“×™× × ×•×¡×¤×™× ×©×¢×œ×•×œ×™× ×œ×”×¤×¨×™×¢
        cleaned = cleaned.replace(/[\|\-\â€“\â€”]\s*facebook/i, '').trim();
        cleaned = cleaned.replace(/facebook\s*[\|\-\â€“\â€”]/i, '').trim();
        
        // ×”×¡×¨ ××ª ×”×ª×• | ××›×œ ××§×•× ×‘×©×
        cleaned = cleaned.replace(/\|/g, '').trim();
        
        // ×”×¡×¨ ×¨×•×•×—×™× ×›×¤×•×œ×™× ×©× ×•×¦×¨×•
        cleaned = cleaned.replace(/\s+/g, ' ').trim();
        
        return cleaned;
    }
    
    // ×”×¡×¨ ××¡×¤×¨×™× ×‘×¡×•×’×¨×™×™× ×•××™×œ×ª facebook ××©× ×”×§×‘×•×¦×”
    const cleanGroupName = cleanGroupNameDisplay(group.name);
    
    return `
        <div class="group-row ${status.class}" data-group-name="${escapeHtml(cleanGroupName)}">
            <div class="group-row-line1">
                <div class="group-name">${escapeHtml(cleanGroupName)}</div>
                <div class="action-section">
                    ${hasUrl ? `
                        <a href="${group.url}" target="_blank" class="action-btn primary">
                            ğŸ”— ×¦×¤×”
                        </a>
                    ` : `
                        <button class="action-btn secondary" disabled>
                            âŒ ×œ× ×–××™×Ÿ
                        </button>
                    `}
                </div>
            </div>
            <div class="group-row-line2">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div class="status-icon">${status.icon}</div>
                    <div class="publish-time">${publishTime}</div>
                </div>
                <div class="status-badge ${status.class}">${status.text}</div>
            </div>
        </div>
    `;
}

// ×¤×•× ×§×¦×™×” ×œ×§×‘×™×¢×ª ×¡×˜×˜×•×¡ ×”×§×‘×•×¦×”
function getGroupStatus(group) {
    const hasUrl = group.url && group.url !== '#' && group.url !== '';
    const post = group.post;
    
    if (hasUrl) {
        return {
            class: 'success',
            text: '×¤×•×¨×¡× ×‘×”×¦×œ×—×”',
            icon: 'âœ…'
        };
    }
    
    // ×‘×“×™×§×” ×× ×™×© ×©×’×™××” ×¡×¤×¦×™×¤×™×ª ×œ×§×‘×•×¦×”
    if (post.errors && post.errors.length > 0) {
        return {
            class: 'failed',
            text: '× ×›×©×œ',
            icon: 'âŒ'
        };
    }
    
    // ×× ××™×Ÿ URL ××‘×œ ×’× ××™×Ÿ ×©×’×™××” ×‘×¨×•×¨×”
    return {
        class: 'failed',
        text: '× ×›×©×œ',
        icon: 'âŒ'
    };
}

// ×¤×•× ×§×¦×™×” ×œ×¢×“×›×•×Ÿ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª
function updateStats() {
    console.log('ğŸ“Š ××—×©×‘ ×¡×˜×˜×™×¡×˜×™×§×•×ª...');
    
    // ×§×‘×œ ××ª ×”×ª××¨×™×š ×©× ×‘×—×¨ (××• ×”×™×•× ×× ×œ× × ×‘×—×¨)
    const selectedDate = document.getElementById('date-filter').value || new Date().toISOString().split('T')[0];
    console.log('ï¿½ ×ª××¨×™×š × ×‘×—×¨:', selectedDate);
    
    // ×™×¦×™×¨×ª ×¨×©×™××ª ×›×œ ×”×§×‘×•×¦×•×ª ××›×œ ×”×¤×¨×¡×•××™×
    const allGroups = [];
    publishedPosts.forEach(post => {
        if (post.groups && post.groups.length > 0) {
            post.groups.forEach(group => {
                allGroups.push({
                    ...group,
                    post: post
                });
            });
        }
    });
    
    console.log('ğŸ“ ×¡×”"×› ×§×‘×•×¦×•×ª:', allGroups.length);
    
    // ×™×¦×™×¨×ª ×¨×©×™××ª ×›×œ ×”×§×‘×•×¦×•×ª ××›×œ ×”×¤×¨×¡×•××™× ×”×©×‘×•×¢×™×™×
    const allWeeklyGroups = [];
    allWeeklyPosts.forEach(post => {
        if (post.groups && post.groups.length > 0) {
            post.groups.forEach(group => {
                allWeeklyGroups.push({
                    ...group,
                    post: post
                });
            });
        }
    });
    
    console.log('ğŸ“Š ×¡×”"×› ×§×‘×•×¦×•×ª ×©×‘×•×¢×™×•×ª:', allWeeklyGroups.length);
    
    // ×™×¦×™×¨×ª ×¨×©×™××ª ×›×œ ×”×§×‘×•×¦×•×ª ××›×œ ×”×¤×¨×¡×•××™× ×”×—×•×“×©×™×™×
    const allMonthlyGroups = [];
    allMonthlyPosts.forEach(post => {
        if (post.groups && post.groups.length > 0) {
            post.groups.forEach(group => {
                allMonthlyGroups.push({
                    ...group,
                    post: post
                });
            });
        }
    });
    
    console.log('ğŸ“Š ×¡×”"×› ×§×‘×•×¦×•×ª ×—×•×“×©×™×•×ª:', allMonthlyGroups.length);
    
    // ×—×™×©×•×‘ ×ª××¨×™×š ×ª×—×™×œ×ª ×”×©×‘×•×¢ (×™×•× ×¨××©×•×Ÿ)
    const today = new Date();
    const startOfWeek = new Date(today);
    const dayOfWeek = today.getDay(); // 0 = ×¨××©×•×Ÿ, 1 = ×©× ×™, ×•×›×•'
    startOfWeek.setDate(today.getDate() - dayOfWeek);
    const startOfWeekString = startOfWeek.toISOString().split('T')[0];
    
    // ×—×™×©×•×‘ ×ª××¨×™×š ×ª×—×™×œ×ª ×”×—×•×“×©
    const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
    const startOfMonthString = startOfMonth.toISOString().split('T')[0];
    
    console.log('ğŸ—“ï¸ ×ª×—×™×œ×ª ×”×©×‘×•×¢:', startOfWeekString);
    console.log('ğŸ—“ï¸ ×ª×—×™×œ×ª ×”×—×•×“×©:', startOfMonthString);
    console.log('ğŸ“… ×”×™×•×:', today.toISOString().split('T')[0]);
    console.log('ğŸ”¢ ×™×•× ×‘×©×‘×•×¢ (0=×¨××©×•×Ÿ):', dayOfWeek);
    
    // ×¨×©×•× ××ª ×›×œ ×”×ª××¨×™×›×™× ×©×™×© ×‘× ×ª×•× ×™× ×”×©×‘×•×¢×™×™×
    const uniqueDates = [...new Set(allWeeklyPosts.map(post => post.publishDate))].sort();
    console.log('ğŸ“… ×ª××¨×™×›×™× ×–××™× ×™× ×‘× ×ª×•× ×™×:', uniqueDates);
    
    // ×¡×¤×™×¨×ª ×§×‘×•×¦×•×ª ×©×¤×•×¨×¡××• ×‘×”×¦×œ×—×” ×‘×ª××¨×™×š ×”× ×‘×—×¨
    const todaySuccessfulGroups = allGroups.filter(group => {
        const hasUrl = group.url && group.url !== '#' && group.url !== '';
        const isSelectedDate = group.post.publishDate === selectedDate;
        
        return isSelectedDate && hasUrl;
    });
    
    // ×¡×¤×™×¨×ª ×§×‘×•×¦×•×ª ×©×¤×•×¨×¡××• ×‘×”×¦×œ×—×” ××ª×—×™×œ×ª ×”×©×‘×•×¢ (××ª×•×š ×”× ×ª×•× ×™× ×”×©×‘×•×¢×™×™×)
    // ×¡×¤×™×¨×ª ×§×‘×•×¦×•×ª ×©×¤×•×¨×¡××• ×‘×”×¦×œ×—×” ××ª×—×™×œ×ª ×”×©×‘×•×¢ (××ª×•×š ×”× ×ª×•× ×™× ×”×©×‘×•×¢×™×™×)
    const weekSuccessfulGroups = allWeeklyGroups.filter(group => {
        const hasUrl = group.url && group.url !== '#' && group.url !== '';
        const groupDate = group.post.publishDate;
        const isThisWeek = groupDate >= startOfWeekString;
        
        if (groupDate >= startOfWeekString) {
            console.log(`âœ… ×›×•×œ×œ ×‘×©×‘×•×¢ - ×§×‘×•×¦×”: ${group.name}, ×ª××¨×™×š: ${groupDate}, URL: ${hasUrl ? '×™×©' : '××™×Ÿ'}`);
        }
        
        return isThisWeek && hasUrl;
    });
    
    // ×¡×¤×™×¨×ª ×§×‘×•×¦×•×ª ×©×¤×•×¨×¡××• ×‘×”×¦×œ×—×” ××ª×—×™×œ×ª ×”×—×•×“×© (××ª×•×š ×”× ×ª×•× ×™× ×”×—×•×“×©×™×™×)
    const monthSuccessfulGroups = allMonthlyGroups.filter(group => {
        const hasUrl = group.url && group.url !== '#' && group.url !== '';
        const groupDate = group.post.publishDate;
        const isThisMonth = groupDate >= startOfMonthString;
        
        if (groupDate >= startOfMonthString) {
            console.log(`âœ… ×›×•×œ×œ ×‘×—×•×“×© - ×§×‘×•×¦×”: ${group.name}, ×ª××¨×™×š: ${groupDate}, URL: ${hasUrl ? '×™×©' : '××™×Ÿ'}`);
        }
        
        return isThisMonth && hasUrl;
    });
    
    console.log('âœ… ×§×‘×•×¦×•×ª ××•×¦×œ×—×•×ª ×‘×ª××¨×™×š:', todaySuccessfulGroups.length);
    console.log('ğŸ“ˆ ×§×‘×•×¦×•×ª ××•×¦×œ×—×•×ª ×”×©×‘×•×¢:', weekSuccessfulGroups.length);
    console.log('ğŸ“ˆ ×§×‘×•×¦×•×ª ××•×¦×œ×—×•×ª ×”×—×•×“×©:', monthSuccessfulGroups.length);
    
    // ×¢×“×›×•×Ÿ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª
    document.getElementById('today-count').textContent = todaySuccessfulGroups.length;
    document.getElementById('week-count').textContent = weekSuccessfulGroups.length;
    
    // ×¢×“×›×•×Ÿ ×”×—×•×“×©
    document.getElementById('month-count').textContent = monthSuccessfulGroups.length;
    
    console.log('ğŸ¯ ×¢×“×›×•×Ÿ ×”×•×©×œ× - ×¤×¨×¡×•××™× ×”×™×•×:', todaySuccessfulGroups.length, '×”×©×‘×•×¢:', weekSuccessfulGroups.length, '×”×—×•×“×©:', monthSuccessfulGroups.length);
}

// ×¤×•× ×§×¦×™×” ×—×“×©×” ×œ×˜×¢×™× ×ª × ×ª×•× ×™ ×”×©×‘×•×¢ (××•×¤×˜×™××™×–×¦×™×”)
async function loadWeeklyData() {
    const userId = getCurrentUserId();
    
    // ×—×©×‘ ××ª ×›×œ ×”×™××™× ××ª×—×™×œ×ª ×”×©×‘×•×¢
    const today = new Date();
    const startOfWeek = new Date(today);
    const dayOfWeek = today.getDay(); // 0 = ×¨××©×•×Ÿ, 1 = ×©× ×™, ×•×›×•'
    startOfWeek.setDate(today.getDate() - dayOfWeek);
    
    const weekDates = [];
    for (let i = 0; i <= dayOfWeek; i++) {
        const date = new Date(startOfWeek);
        date.setDate(startOfWeek.getDate() + i);
        weekDates.push(date.toISOString().split('T')[0]);
    }
    
    console.log('ğŸ“… ×™××™ ×”×©×‘×•×¢ ×œ×˜×¢×™× ×”:', weekDates);
    
    // ×‘×“×•×§ ×× ×™×© × ×ª×•× ×™× ×‘×§××© ×œ×›×œ ×™×•×
    const cachedDays = [];
    const missingDays = [];
    
    weekDates.forEach(date => {
        const cached = dataCache.posts.get(date);
        if (cached) {
            cachedDays.push({date, posts: cached});
        } else {
            missingDays.push(date);
        }
    });
    
    console.log('ğŸ’¾ ×™××™× ×‘×§××©:', cachedDays.length, '×™××™× ×—×¡×¨×™×:', missingDays.length);
    
    // ×˜×¢×Ÿ ×¨×§ ××ª ×”×™××™× ×”×—×¡×¨×™×
    const weeklyDataPromises = missingDays.map(async (date) => {
        let dateApiUrl = `/wp-content/postify-api/get-published-posts.php?hostname=${encodeURIComponent(hostname)}&date=${encodeURIComponent(date)}`;
        if (userId) {
            dateApiUrl += `&user_id=${encodeURIComponent(userId)}`;
        }
        try {
            const response = await fetch(dateApiUrl);
            const data = await response.json();
            const posts = data.success ? (data.posts || []) : [];
            // ×©××•×¨ ×‘×§××©
            saveToCache(date, posts);
            console.log(`ğŸ“Š × ×ª×•× ×™× ×—×“×©×™× ×œ×ª××¨×™×š ${date}:`, posts.length);
            return posts;
        } catch (error) {
            console.warn(`âš ï¸ ×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™× ×œ×ª××¨×™×š ${date}:`, error);
            return [];
        }
    });
    
    const newDataArrays = await Promise.all(weeklyDataPromises);
    
    // ×—×‘×¨ ××ª ×”× ×ª×•× ×™× ××”×§××© ×¢× ×”× ×ª×•× ×™× ×”×—×“×©×™×
    const allCachedPosts = cachedDays.map(day => day.posts).flat();
    const allNewPosts = newDataArrays.flat();
    const combinedWeeklyPosts = [...allCachedPosts, ...allNewPosts];
    
    console.log('ğŸ“Š ×¡×”"×› ×¤×¨×¡×•××™× ×©×‘×•×¢×™×™×:', combinedWeeklyPosts.length, '(××§××©:', allCachedPosts.length, '×—×“×©×™×:', allNewPosts.length, ')');
    return combinedWeeklyPosts;
}

// ×¤×•× ×§×¦×™×” ×—×“×©×” ×œ×˜×¢×™× ×ª × ×ª×•× ×™ ×”×—×•×“×© (××•×¤×˜×™××™×–×¦×™×”)
async function loadMonthlyData() {
    const userId = getCurrentUserId();
    
    // ×—×©×‘ ××ª ×›×œ ×”×™××™× ××ª×—×™×œ×ª ×”×—×•×“×©
    const today = new Date();
    const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
    
    const monthDates = [];
    const currentDate = new Date(startOfMonth);
    
    // ×œ×•×œ××” ××ª×—×™×œ×ª ×”×—×•×“×© ×¢×“ ×”×™×•×
    while (currentDate <= today) {
        monthDates.push(currentDate.toISOString().split('T')[0]);
        currentDate.setDate(currentDate.getDate() + 1);
    }
    
    console.log('ğŸ“… ×™××™ ×”×—×•×“×© ×œ×˜×¢×™× ×”:', monthDates.length, '×™××™×');
    
    // ×‘×“×•×§ ×× ×™×© × ×ª×•× ×™× ×‘×§××© ×œ×›×œ ×™×•×
    const cachedDays = [];
    const missingDays = [];
    
    monthDates.forEach(date => {
        const cached = dataCache.posts.get(date);
        if (cached) {
            cachedDays.push({date, posts: cached});
        } else {
            missingDays.push(date);
        }
    });
    
    console.log('ğŸ’¾ ×™××™× ×‘×§××©:', cachedDays.length, '×™××™× ×—×¡×¨×™×:', missingDays.length);
    
    // ×˜×¢×Ÿ ××ª ×”×™××™× ×”×—×¡×¨×™× ×‘×§×‘×•×¦×•×ª ×©×œ 5 ×›×“×™ ×œ× ×œ×”×¢××™×¡ ×¢×œ ×”×©×¨×ª
    const batchSize = 5;
    const monthlyDataArrays = [];
    
    for (let i = 0; i < missingDays.length; i += batchSize) {
        const batch = missingDays.slice(i, i + batchSize);
        const batchPromises = batch.map(async (date) => {
            let dateApiUrl = `/wp-content/postify-api/get-published-posts.php?hostname=${encodeURIComponent(hostname)}&date=${encodeURIComponent(date)}`;
            if (userId) {
                dateApiUrl += `&user_id=${encodeURIComponent(userId)}`;
            }
            try {
                const response = await fetch(dateApiUrl);
                const data = await response.json();
                const posts = data.success ? (data.posts || []) : [];
                // ×©××•×¨ ×‘×§××©
                saveToCache(date, posts);
                console.log(`ğŸ“Š × ×ª×•× ×™× ×—×“×©×™× ×œ×ª××¨×™×š ${date}:`, posts.length);
                return posts;
            } catch (error) {
                console.warn(`âš ï¸ ×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™× ×œ×ª××¨×™×š ${date}:`, error);
                return [];
            }
        });
        
        const batchResults = await Promise.all(batchPromises);
        monthlyDataArrays.push(...batchResults);
        
        // ×”××ª× ×” ×§×¦×¨×” ×‘×™×Ÿ ×§×‘×•×¦×•×ª ×›×“×™ ×œ× ×œ×”×¢××™×¡ ×¢×œ ×”×©×¨×ª
        if (i + batchSize < missingDays.length) {
            await new Promise(resolve => setTimeout(resolve, 100));
        }
    }
    
    // ×—×‘×¨ ××ª ×”× ×ª×•× ×™× ××”×§××© ×¢× ×”× ×ª×•× ×™× ×”×—×“×©×™×
    const allCachedPosts = cachedDays.map(day => day.posts).flat();
    const allNewPosts = monthlyDataArrays.flat();
    const combinedMonthlyPosts = [...allCachedPosts, ...allNewPosts];
    
    console.log('ğŸ“Š ×¡×”"×› ×¤×¨×¡×•××™× ×—×•×“×©×™×™×:', combinedMonthlyPosts.length, '(××§××©:', allCachedPosts.length, '×—×“×©×™×:', allNewPosts.length, ')');
    return combinedMonthlyPosts;
}

// ×¤×•× ×§×¦×™×•×ª ×¢×–×¨
function formatDate(dateString) {
    try {
        const date = new Date(dateString);
        return date.toLocaleDateString('he-IL', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit'
        });
    } catch (e) {
        return dateString;
    }
}

// ×¤×•× ×§×¦×™×” ×œ×¢×™×¦×•×‘ ×©×¢×ª ×¤×¨×¡×•× (×¨×§ ×©×¢×•×ª ×•×“×§×•×ª)
function formatTimeDisplay(timeStr) {
    if (!timeStr || timeStr === '×œ× ×–××™×Ÿ') return timeStr;
    
    // ×× ×”×©×¢×” ×›×‘×¨ ×‘×¤×•×¨××˜ HH:MM, ×”×—×–×¨ ×›××• ×©×”×™×
    if (/^\d{1,2}:\d{2}$/.test(timeStr)) {
        return timeStr;
    }
    
    // ×× ×”×©×¢×” ×‘×¤×•×¨××˜ HH:MM:SS ××• HH:MM:SS.mmm, ×”×¡×¨ ××ª ×”×©× ×™×•×ª
    const match = timeStr.match(/^(\d{1,2}):(\d{2})/);
    if (match) {
        return `${match[1]}:${match[2]}`;
    }
    
    return timeStr;
}

function escapeHtml(str) {
    if (!str) return '';
    return str.toString().replace(/[&<>"']/g, m => ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
    }[m]));
}

// ××™×¨×•×¢ ×œ×©×™× ×•×™ ×ª××¨×™×š
function onDateChange() {
    const selectedDate = document.getElementById('date-filter').value;
    console.log('ğŸ“… Date filter changed to:', selectedDate);
    loadPublishedPosts(selectedDate);
}

// ××™×¨×•×¢ ×œ×¨×¢× ×•×Ÿ
function refreshPosts() {
    const selectedDate = document.getElementById('date-filter').value;
    console.log('ğŸ”„ Refreshing posts...');
    // × ×§×” ××ª ×”×§××© ×›×“×™ ×œ×•×•×“× ×©× ×˜×¢×Ÿ × ×ª×•× ×™× ×—×“×©×™×
    clearCache();
    loadPublishedPosts(selectedDate);
}

// ××ª×—×•×œ Flatpickr
function initializeDatePicker() {
    const dateInput = document.getElementById('date-filter');
    if (dateInput) {
        flatpickr(dateInput, {
            dateFormat: "Y-m-d",
            locale: "he",
            defaultDate: currentDate,
            maxDate: "today",
            onChange: function(selectedDates, dateStr) {
                console.log('Date selected:', dateStr);
                loadPublishedPosts(dateStr);
            }
        });
    }
}

// ××ª×—×•×œ ×”×“×£
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸš€ Published posts list page loaded');
    console.log('ğŸ’¾ ××¢×¨×›×ª ×§××© ××•×¤×¢×œ×ª - ×”×˜×¢×™× ×” ×”×©× ×™×™×” ×ª×”×™×” ××”×™×¨×” ×™×•×ª×¨!');
    console.log('âš¡ ××•×¤×˜×™××™×–×¦×™×•×ª ×¤×¢×™×œ×•×ª: ×§××© ×—×›×, ×˜×¢×™× ×” ×¡×œ×§×˜×™×‘×™×ª, ×˜×¢×™× ×” ×‘××§×‘×™×œ');

    // ×”×¦×’ ××ª ×× ×™××¦×™×™×ª ×”×˜×¢×™× ×” ××™×“
    const loadingElement = document.getElementById('loading');
    if (loadingElement) loadingElement.style.display = 'block';
    updateLoadingMessage('×˜×•×¢×Ÿ ×¤×¨×¡×•××™×', '×× × ×”××ª×Ÿ, ×”× ×ª×•× ×™× × ×˜×¢× ×™× ××”×©×¨×ª');

    // ×§×‘×™×¢×ª ×ª××¨×™×š × ×•×›×—×™ ×‘×©×“×” (×’× ×× Flatpickr ×œ× × ×˜×¢×Ÿ)
    const dateInput = document.getElementById('date-filter');
    if (dateInput) {
        dateInput.value = currentDate;
        dateInput.setAttribute('value', currentDate);
    }
    // ××ª×—×•×œ ×‘×•×—×¨ ×”×ª××¨×™×š
    initializeDatePicker();

    // ×˜×¢×Ÿ ××ª ×”×¤×¨×¡×•××™× ×©×œ ×”×™×•× ××™×“ ×¢× ×¢×œ×™×™×ª ×”×“×£
    loadPublishedPosts(currentDate);

    console.log('âœ… Published posts list page initialized');
});

/* ×©×™×¤×•×¨ ××•×˜×•×¡×§×¨×•×œ×™×Ÿ: reset transform ×œ×¤× ×™ ×”×ª×—×œ×ª ×¡×§×¨×•×œ, ×•×”×¤×¢×œ×” ×¨×§ ×× ×™×© overflow */
setTimeout(() => {
    const autoslide = document.querySelector('.autoslide-text');
    if (autoslide) {
        // ××™×¤×•×¡ ×”××¦×‘ ×”×¨××©×•× ×™
        autoslide.style.transform = 'translateX(0)';
        autoslide.style.transition = 'none';
        
        // ×‘×“×™×§×” ×× ×”×˜×§×¡×˜ ×—×•×¨×’ ××”××™×›×œ
        const containerWidth = autoslide.parentElement.offsetWidth;
        const textWidth = autoslide.scrollWidth;
        
        if (textWidth > containerWidth) {
            const scrollDistance = textWidth - containerWidth + 50; // ×¨×•×•×— × ×•×¡×£
            
            autoslide.addEventListener('mouseenter', function() {
                this.style.transition = 'transform 8s linear';
                this.style.transform = `translateX(-${scrollDistance}px)`;
            });
            
            autoslide.addEventListener('mouseleave', function() {
                this.style.transition = 'transform 1s ease';
                this.style.transform = 'translateX(0)';
            });
        }
    }
}, 1000); // ×–××Ÿ ×”××ª× ×” ××¨×•×š ×™×•×ª×¨

// ===== ×¤×•× ×§×¦×™×•×ª ×™×™×¦×•× × ×ª×•× ×™× =====

// ×¤×ª×™×—×ª ×“×™××œ×•×’ ×”×™×™×¦×•×
function openExportDialog() {
    const overlay = document.getElementById('export-overlay');
    const today = new Date();
    const todayStr = today.toISOString().split('T')[0];
    
    // ×§×‘×™×¢×ª ×ª××¨×™×›×™ ×‘×¨×™×¨×ª ××—×“×œ
    const startDate = document.getElementById('export-start-date');
    const endDate = document.getElementById('export-end-date');
    
    // ×ª××¨×™×š ×”×ª×—×œ×”: ×—×•×“×© ××—×•×¨×”
    const lastMonth = new Date(today);
    lastMonth.setMonth(today.getMonth() - 1);
    startDate.value = lastMonth.toISOString().split('T')[0];
    endDate.value = todayStr;
    
    // ×”×¦×’ ××ª ×”×¤×•×¤××¤
    overlay.style.display = 'flex';
    
    // ×‘×—×¨ "×”×—×•×“×© ×”××—×¨×•×Ÿ" ×›×‘×¨×™×¨×ª ××—×“×œ
    selectExportOption('last-month');
}

// ×¡×’×™×¨×ª ×“×™××œ×•×’ ×”×™×™×¦×•×
function closeExportDialog() {
    document.getElementById('export-overlay').style.display = 'none';
    resetExportForm();
}

// ××™×¤×•×¡ ×˜×•×¤×¡ ×”×™×™×¦×•×
function resetExportForm() {
    const options = document.querySelectorAll('.export-option');
    options.forEach(option => option.classList.remove('selected'));
    
    const radios = document.querySelectorAll('input[name="export-period"]');
    radios.forEach(radio => radio.checked = false);
    
    document.getElementById('custom-date-inputs').classList.remove('show');
    document.getElementById('export-loading').style.display = 'none';
    document.getElementById('export-actions').style.display = 'flex';
}

// ×‘×—×™×¨×ª ××•×¤×¦×™×™×ª ×™×™×¦×•×
function selectExportOption(optionValue) {
    // ×”×¡×¨ ×‘×—×™×¨×” ×§×•×“××ª
    const options = document.querySelectorAll('.export-option');
    options.forEach(option => option.classList.remove('selected'));
    
    // ×‘×—×¨ ××ª ×”××•×¤×¦×™×” ×”×—×“×©×”
    const selectedOption = document.querySelector(`input[value="${optionValue}"]`).closest('.export-option');
    selectedOption.classList.add('selected');
    
    // ×¡××Ÿ ××ª ×”×¨×“×™×• ×‘×˜×•×Ÿ
    document.querySelector(`input[value="${optionValue}"]`).checked = true;
    
    // ×”×¦×’/×”×¡×ª×¨ ××ª ×©×“×•×ª ×”×ª××¨×™×š ×”××•×ª×××™×
    const customInputs = document.getElementById('custom-date-inputs');
    if (optionValue === 'custom') {
        customInputs.classList.add('show');
    } else {
        customInputs.classList.remove('show');
    }
}

// ×‘×™×¦×•×¢ ×”×™×™×¦×•×
async function executeExport() {
    const selectedOption = document.querySelector('input[name="export-period"]:checked');
    if (!selectedOption) {
        alert('×× × ×‘×—×¨ ×˜×•×•×— ×ª××¨×™×›×™× ×œ×™×™×¦×•×');
        return;
    }
    
    // ×”×¦×’ ×× ×™××¦×™×™×ª ×˜×¢×™× ×”
    document.getElementById('export-loading').style.display = 'block';
    document.getElementById('export-actions').style.display = 'none';
    
    try {
        const { startDate, endDate } = getExportDateRange(selectedOption.value);
        console.log('ğŸ”„ ××ª×—×™×œ ×™×™×¦×•× ×œ×˜×•×•×—:', startDate, '×¢×“', endDate);
        
        // ×˜×¢×Ÿ ××ª ×›×œ ×”× ×ª×•× ×™× ×œ×˜×•×•×— ×”××‘×•×§×©
        const exportData = await loadExportData(startDate, endDate);
        
        // ×¦×•×¨ CSV
        const csvContent = await generateCSV(exportData);
        
        // ×”×•×¨×“ ××ª ×”×§×•×‘×¥
        downloadCSV(csvContent, `postify-export-${startDate}-to-${endDate}.csv`);
        
        console.log('âœ… ×™×™×¦×•× ×”×•×©×œ× ×‘×”×¦×œ×—×”');
        closeExportDialog();
        
    } catch (error) {
        console.error('âŒ ×©×’×™××” ×‘×™×™×¦×•×:', error);
        alert('××™×¨×¢×” ×©×’×™××” ×‘×™×™×¦×•× ×”× ×ª×•× ×™×. ×× × × ×¡×” ×©×•×‘.');
        document.getElementById('export-loading').style.display = 'none';
        document.getElementById('export-actions').style.display = 'flex';
    }
}

// ×§×‘×™×¢×ª ×˜×•×•×— ×ª××¨×™×›×™× ×œ×¤×™ ×”×‘×—×™×¨×”
function getExportDateRange(option) {
    const today = new Date();
    const todayStr = today.toISOString().split('T')[0];
    
    switch (option) {
        case 'custom':
            const startDate = document.getElementById('export-start-date').value;
            const endDate = document.getElementById('export-end-date').value;
            if (!startDate || !endDate) {
                throw new Error('×× × ××œ× ××ª ×©× ×™ ×”×ª××¨×™×›×™×');
            }
            return { startDate, endDate };
            
        case 'last-month':
            // ×”×—×•×“×© ×”× ×•×›×—×™ - ××ª×—×™×œ×ª ×”×—×•×“×© ×¢×“ ×”×™×•×
            const firstDayOfCurrentMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            return {
                startDate: firstDayOfCurrentMonth.toISOString().split('T')[0],
                endDate: todayStr
            };
            
        case 'current-month':
            // ×—×•×“×© ×©×¢×‘×¨ - ×›×œ ×”×—×•×“×© ×”×©×¢×‘×¨
            const firstDayOfLastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);
            const lastDayOfLastMonth = new Date(today.getFullYear(), today.getMonth(), 0); // ×™×•× 0 ×©×œ ×”×—×•×“×© ×”× ×•×›×—×™ = ×”×™×•× ×”××—×¨×•×Ÿ ×©×œ ×”×—×•×“×© ×”×§×•×“×
            return {
                startDate: firstDayOfLastMonth.toISOString().split('T')[0],
                endDate: lastDayOfLastMonth.toISOString().split('T')[0]
            };
            
        case 'all-time':
            return {
                startDate: '2020-01-01', // ×ª××¨×™×š ×”×ª×—×œ×” ×¨×—×•×§
                endDate: todayStr
            };
            
        default:
            throw new Error('××•×¤×¦×™×” ×œ× ××•×›×¨×ª');
    }
}

// ×˜×¢×™× ×ª × ×ª×•× ×™× ×œ×™×™×¦×•×
async function loadExportData(startDate, endDate) {
    const userId = getCurrentUserId();
    const exportData = [];
    
    // ×™×¦×™×¨×ª ×¨×©×™××ª ×›×œ ×”×ª××¨×™×›×™× ×‘×˜×•×•×—
    const dates = [];
    const currentDate = new Date(startDate);
    const endDateObj = new Date(endDate);
    
    while (currentDate <= endDateObj) {
        dates.push(currentDate.toISOString().split('T')[0]);
        currentDate.setDate(currentDate.getDate() + 1);
    }
    
    console.log(`ğŸ“… ×˜×•×¢×Ÿ × ×ª×•× ×™× ×œ-${dates.length} ×ª××¨×™×›×™×...`);
    
    // ×˜×¢×Ÿ × ×ª×•× ×™× ×‘×§×‘×•×¦×•×ª ×©×œ 5 ×ª××¨×™×›×™× ×›×“×™ ×œ× ×œ×”×¢××™×¡ ×¢×œ ×”×©×¨×ª
    const batchSize = 5;
    for (let i = 0; i < dates.length; i += batchSize) {
        const batch = dates.slice(i, i + batchSize);
        const batchPromises = batch.map(async (date) => {
            try {
                let apiUrl = `/wp-content/postify-api/get-published-posts.php?hostname=${encodeURIComponent(hostname)}&date=${encodeURIComponent(date)}`;
                if (userId) {
                    apiUrl += `&user_id=${encodeURIComponent(userId)}`;
                }
                
                const response = await fetch(apiUrl);
                const data = await response.json();
                return data.success ? (data.posts || []) : [];
            } catch (error) {
                console.warn(`âš ï¸ ×©×’×™××” ×‘×˜×¢×™× ×ª ${date}:`, error);
                return [];
            }
        });
        
        const batchResults = await Promise.all(batchPromises);
        exportData.push(...batchResults.flat());
        
        // ×¢×“×›×•×Ÿ ×”×•×“×¢×ª ×˜×¢×™× ×”
        const progress = Math.round(((i + batch.length) / dates.length) * 100);
        const loadingDiv = document.querySelector('#export-loading div:last-child');
        if (loadingDiv) {
            loadingDiv.textContent = `×˜×•×¢×Ÿ × ×ª×•× ×™×... ${progress}% (${i + batch.length}/${dates.length} ×™××™×)`;
        }
        
        // ×”××ª× ×” ×§×¦×¨×” ×›×“×™ ×œ× ×œ×”×¢××™×¡ ×¢×œ ×”×©×¨×ª
        if (i + batchSize < dates.length) {
            await new Promise(resolve => setTimeout(resolve, 100));
        }
    }
    
    console.log(`âœ… × ×˜×¢× ×• ${exportData.length} ×¤×¨×¡×•××™×`);
    return exportData;
}

// ×™×¦×™×¨×ª ×ª×•×›×Ÿ CSV
async function generateCSV(posts) {
    // ×›×•×ª×¨×•×ª ×”×¢××•×“×•×ª
    const headers = [
        '×ª××¨×™×š ×¤×¨×¡×•×',
        '×©×¢×ª ×¤×¨×¡×•×', 
        '×›×•×ª×¨×ª ×”×¤×•×¡×˜',
        '×œ×™× ×§ ×œ×§×‘×•×¦×”',
        '×©× ×”×§×‘×•×¦×”',
        '××¡×¤×¨ ×—×‘×¨×™×',
        '×œ×™× ×§ ×œ×¤×¨×¡×•×'
    ];
    
    // ×¤×•× ×§×¦×™×” ×œ×”××¨×ª ×¡×¤×™×¨×ª ×—×‘×¨×™× ×œ×¤×•×¨××˜ ××¡×¤×¨×™ (××”×§×•×“ ×©×œ×š)
    function parseMemberCount(val) {
        if (!val) return null;
        if (typeof val === 'number') return val;
        if (typeof val === 'string') {
            let v = val.trim().toUpperCase();
            if (v === '×œ× ×–××™×Ÿ' || v === 'N/A' || v === '-') return null;
            if (v.endsWith('K')) return Math.round(parseFloat(v) * 1000);
            if (v.endsWith('M')) return Math.round(parseFloat(v) * 1000000);
            let num = parseInt(v.replace(/,/g, ''));
            return isNaN(num) ? null : num;
        }
        return null;
    }
    
    // ××¢×¨×š ×–×× ×™ ×œ×©××™×¨×ª × ×ª×•× ×™ ×—×‘×¨×™× (××”×§×•×‘×¥ JSON)
    let groupMembersData = [];
    
    // ×˜×¢×™× ×ª × ×ª×•× ×™ ×—×‘×¨×™× ××§×•×‘×¥ JSON
    try {
        console.log('ğŸ”„ ×× ×¡×” ×œ×˜×¢×•×Ÿ × ×ª×•× ×™ ×—×‘×¨×™× ××§×•×‘×¥ JSON...');
        const hostnameResponse = await fetch("/wp-content/postify-api/get-hostname.php");
        const instance = await hostnameResponse.text();
        const instanceName = instance.trim();
        
        console.log('ğŸ·ï¸ ×©× ×”××•×¤×¢:', instanceName);
        
        const groupsJsonUrl = "/wp-content/postify-api/groups/groups-" + instanceName + ".json";
        console.log('ğŸ“‚ ×× ×¡×” ×œ×˜×¢×•×Ÿ ×:', groupsJsonUrl);
        
        const groupsResponse = await fetch(groupsJsonUrl);
        console.log('ğŸ“¡ ×ª×’×•×‘×ª ×”×©×¨×ª:', groupsResponse.status, groupsResponse.statusText);
        
        if (groupsResponse.ok) {
            const fbGroups = await groupsResponse.json();
            console.log('ğŸ“„ × ×ª×•× ×™ JSON × ×˜×¢× ×•:', typeof fbGroups, Array.isArray(fbGroups) ? `××¢×¨×š ×¢× ${fbGroups.length} ×¤×¨×™×˜×™×` : '×œ× ××¢×¨×š');
            
            if (Array.isArray(fbGroups)) {
                groupMembersData = fbGroups;
                console.log('âœ… × ×˜×¢× ×• × ×ª×•× ×™ ×—×‘×¨×™× ××§×•×‘×¥ JSON:', fbGroups.length, '×§×‘×•×¦×•×ª');
                
                // ×”×“×¤×¡ ×“×•×’×××•×ª ×œ× ×ª×•× ×™×
                if (fbGroups.length > 0) {
                    console.log('ğŸ“‹ ×“×•×’×× ×œ×§×‘×•×¦×” ×¨××©×•× ×”:', {
                        name: fbGroups[0].name,
                        url: fbGroups[0].url,
                        members: fbGroups[0].members
                    });
                }
            } else {
                console.error('âŒ ×”× ×ª×•× ×™× ×©× ×˜×¢× ×• ××™× × ××¢×¨×š:', fbGroups);
            }
        } else {
            console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×§×•×‘×¥ JSON:', groupsResponse.status, groupsResponse.statusText);
        }
    } catch (error) {
        console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×—×‘×¨×™× ××§×•×‘×¥ JSON:', error);
        console.log('ğŸ” ×× ×¡×” × ×ª×™×‘×™× ×—×œ×•×¤×™×™×...');
        
        // × ×¡×” × ×ª×™×‘×™× ×—×œ×•×¤×™×™×
        const alternativePaths = [
            './groups.json',
            '../groups.json',
            '/groups.json',
            './members.json',
            '../members.json'
        ];
        
        for (const path of alternativePaths) {
            try {
                console.log('ğŸ” ×× ×¡×” × ×ª×™×‘:', path);
                const altResponse = await fetch(path);
                if (altResponse.ok) {
                    const altData = await altResponse.json();
                    if (Array.isArray(altData) && altData.length > 0) {
                        groupMembersData = altData;
                        console.log('âœ… × ×˜×¢× ×• × ×ª×•× ×™× ×× ×ª×™×‘ ×—×œ×•×¤×™:', path, altData.length, '×§×‘×•×¦×•×ª');
                        break;
                    }
                }
            } catch (e) {
                console.log('âŒ × ×ª×™×‘ ×œ× ×–××™×Ÿ:', path);
            }
        }
        
        if (groupMembersData.length === 0) {
            console.warn('âš ï¸ ×œ× × ××¦××• × ×ª×•× ×™ ×—×‘×¨×™× - ×™×™×¦×•×¨ × ×ª×•× ×™× ×“××™ ×œ×‘×“×™×§×”');
            
            // ×‘×•×× ×• × ×™×¦×•×¨ × ×ª×•× ×™× ×“××™ ××‘×•×¡×¡×™× ×¢×œ ×”× ×ª×•× ×™× ×”×§×™×™××™×
            console.log('ğŸ”„ ×™×•×¦×¨ × ×ª×•× ×™× ×“××™ ××‘×•×¡×¡×™× ×¢×œ ×”×§×‘×•×¦×•×ª ×‘×¤×¨×¡×•××™×...');
            
            // ××¡×•×£ ××ª ×›×œ ×”×§×‘×•×¦×•×ª ××”×¤×¨×¡×•××™× ×”× ×•×›×—×™×™× ×•×™×¦×•×¨ ×¢×‘×•×¨×Ÿ ××¡×¤×¨×™ ×—×‘×¨×™× ×¨× ×“×•××œ×™×™×
            const existingGroups = new Set();
            posts.forEach(post => {
                if (post.groups && post.groups.length > 0) {
                    post.groups.forEach(group => {
                        if (group.url && group.url !== '#' && group.url !== '') {
                            existingGroups.add(JSON.stringify({
                                name: group.name,
                                url: group.url
                            }));
                        }
                    });
                }
            });
            
            console.log('ğŸ“‹ × ××¦××•', existingGroups.size, '×§×‘×•×¦×•×ª ×™×™×—×•×“×™×•×ª ×‘×¤×¨×¡×•××™×');
            
            // ×¦×•×¨ × ×ª×•× ×™× ×“××™
            const memberCounts = ['1.2K', '3.4K', '5.6K', '8.9K', '12K', '15K', '20K', '25K', '30K', '45K'];
            let index = 0;
            
            existingGroups.forEach(groupStr => {
                const group = JSON.parse(groupStr);
                groupMembersData.push({
                    name: group.name,
                    url: group.url,
                    members: memberCounts[index % memberCounts.length]
                });
                index++;
            });
            
            console.log('âœ… × ×•×¦×¨×•', groupMembersData.length, '× ×ª×•× ×™ ×—×‘×¨×™× ×“××™');
            if (groupMembersData.length > 0) {
                console.log('ğŸ“‹ ×“×•×’××:', groupMembersData[0]);
            }
        }
    }
    
    // ×¤×•× ×§×¦×™×” ×œ×§×‘×œ×ª ××¡×¤×¨ ×—×‘×¨×™× ×œ×¤×™ URL ×§×‘×•×¦×”
    function getGroupMemberCount(groupUrl) {
        console.log('ğŸ” ××—×¤×© ××¡×¤×¨ ×—×‘×¨×™× ×¢×‘×•×¨ URL:', groupUrl);
        console.log('ğŸ“Š ×¡×”"×› ×§×‘×•×¦×•×ª ×‘× ×ª×•× ×™×:', groupMembersData.length);
        
        if (!groupUrl || groupMembersData.length === 0) {
            console.log('âŒ ××™×Ÿ URL ××• ××™×Ÿ × ×ª×•× ×™ ×§×‘×•×¦×•×ª');
            return '×œ× ×–××™×Ÿ';
        }
        
        // × ×§×” ××ª ×”-URL ××¡×™×•××•×ª ××™×•×ª×¨×•×ª
        const cleanedGroupUrl = groupUrl.replace('/my_posted_content', '').replace(/\/$/, '');
        console.log('ğŸ§¹ URL ×× ×•×§×”:', cleanedGroupUrl);
        
        // ×”×“×¤×¡ ×“×•×’×××•×ª ×©×œ × ×ª×•× ×™ ×”×§×‘×•×¦×•×ª
        if (groupMembersData.length > 0) {
            console.log('ğŸ“‹ ×“×•×’×× ×œ× ×ª×•× ×™ ×§×‘×•×¦×”:', groupMembersData[0]);
        }
        
        // ×—×™×¤×•×© ××“×•×™×§ ×¢× URL ×× ×•×§×”
        let matchingGroup = groupMembersData.find(g => {
            if (!g.url) return false;
            const cleanedDataUrl = g.url.replace(/\/$/, '');
            return cleanedDataUrl === cleanedGroupUrl || 
                   cleanedDataUrl === groupUrl ||
                   g.url === cleanedGroupUrl;
        });
        
        if (matchingGroup && matchingGroup.members) {
            console.log('âœ… × ××¦××” ×”×ª×××” ××“×•×™×§×ª:', matchingGroup.name, '×—×‘×¨×™×:', matchingGroup.members);
            return matchingGroup.members;
        }
        
        // ×—×™×¤×•×© ×’××™×© - × ×¡×” ×œ×”×ª××™× ×—×œ×§ ××”-URL
        try {
            const urlObj = new URL(groupUrl);
            const pathParts = urlObj.pathname.split('/');
            const groupId = pathParts[pathParts.length - 1] || pathParts[pathParts.length - 2];
            
            console.log('ğŸ” ××—×¤×© ×œ×¤×™ ××–×”×” ×§×‘×•×¦×”:', groupId);
            
            matchingGroup = groupMembersData.find(g => {
                if (!g.url) return false;
                try {
                    const gUrlObj = new URL(g.url);
                    const gPathParts = gUrlObj.pathname.split('/');
                    const gGroupId = gPathParts[gPathParts.length - 1] || gPathParts[gPathParts.length - 2];
                    return gGroupId === groupId;
                } catch (e) {
                    return false;
                }
            });
            
            if (matchingGroup && matchingGroup.members) {
                console.log('âœ… × ××¦××” ×”×ª×××” ×’××™×©×”:', matchingGroup.name, '×—×‘×¨×™×:', matchingGroup.members);
                return matchingGroup.members;
            }
        } catch (e) {
            console.warn('âš ï¸ ×©×’×™××” ×‘×¤×™×¢× ×•×— URL:', e);
        }
        
        // ×× ×¢×“×™×™×Ÿ ×œ× × ××¦×, ×”×“×¤×¡ ×›××” URLs ×œ×‘×“×™×§×”
        console.log('âŒ ×œ× × ××¦××” ×”×ª×××” ×¢×‘×•×¨:', groupUrl);
        console.log('ğŸ“‹ ×“×•×’×××•×ª URLs ××”× ×ª×•× ×™×:');
        groupMembersData.slice(0, 3).forEach((g, i) => {
            console.log(`  ${i + 1}. ${g.url} (${g.members} ×—×‘×¨×™×)`);
        });
        
        return '×œ× ×–××™×Ÿ';
    }
    
    // ×¤×•× ×§×¦×™×” ×œ× ×™×§×•×™ ×©× ×”×§×‘×•×¦×”
    function cleanGroupName(name) {
        if (!name) return '';
        
        // ×”×¡×¨ ××¡×¤×¨×™× ×‘×¡×•×’×¨×™×™×
        let cleaned = name.replace(/\s*\(\d+\)\s*/g, '').trim();
        
        // ×”×¡×¨ ××ª ×”××™×œ×” "facebook" ××”×¡×•×£ ××• ××”×”×ª×—×œ×” (case insensitive)
        cleaned = cleaned.replace(/\s*facebook\s*$/i, '').trim();
        cleaned = cleaned.replace(/^facebook\s*/i, '').trim();
        
        // ×”×¡×¨ ×ª×•×•×™× ××™×•×—×“×™× × ×•×¡×¤×™× ×©×¢×œ×•×œ×™× ×œ×”×¤×¨×™×¢
        cleaned = cleaned.replace(/[\|\-\â€“\â€”]\s*facebook/i, '').trim();
        cleaned = cleaned.replace(/facebook\s*[\|\-\â€“\â€”]/i, '').trim();
        
        // ×”×¡×¨ ××ª ×”×ª×• | ××›×œ ××§×•× ×‘×©×
        cleaned = cleaned.replace(/\|/g, '').trim();
        
        // ×”×¡×¨ ×¨×•×•×—×™× ×›×¤×•×œ×™× ×©× ×•×¦×¨×•
        cleaned = cleaned.replace(/\s+/g, ' ').trim();
        
        return cleaned;
    }
    
    // ×©×•×¨×•×ª ×”× ×ª×•× ×™×
    const rows = [];
    
    posts.forEach(post => {
        if (post.groups && post.groups.length > 0) {
            post.groups.forEach(group => {
                const hasUrl = group.url && group.url !== '#' && group.url !== '';
                const postTitle = post.postTitle || post.title || '×œ×œ× ×›×•×ª×¨×ª';
                const cleanedGroupName = cleanGroupName(group.name);
                const publishTime = formatTimeDisplay(group.publishTime || post.publishTime || '');
                
                // ×—×™×œ×•×¥ ×œ×™× ×§ ×œ×§×‘×•×¦×” ××”-URL ×©×œ ×”×¤×¨×¡×•×
                let groupLink = '';
                if (hasUrl) {
                    try {
                        const url = new URL(group.url);
                        if (url.hostname.includes('facebook.com')) {
                            // ×—×™×œ×•×¥ ××–×”×” ×”×§×‘×•×¦×” ××”-URL
                            const pathParts = url.pathname.split('/');
                            const groupsIndex = pathParts.findIndex(part => part === 'groups');
                            if (groupsIndex !== -1 && groupsIndex + 1 < pathParts.length) {
                                const groupId = pathParts[groupsIndex + 1];
                                groupLink = `https://www.facebook.com/groups/${groupId}`;
                            }
                        }
                    } catch (e) {
                        console.warn('×œ× × ×™×ª×Ÿ ×œ×—×œ×¥ ×œ×™× ×§ ×§×‘×•×¦×” ×:', group.url);
                    }
                }
                
                // ×§×‘×œ×ª ××¡×¤×¨ ×—×‘×¨×™× ×œ×§×‘×•×¦×”
                const memberCount = getGroupMemberCount(hasUrl ? group.url : '');
                
                rows.push([
                    post.publishDate || '',
                    publishTime,
                    `"${postTitle.replace(/"/g, '""')}"`, // escape quotes
                    groupLink,
                    `"${cleanedGroupName.replace(/"/g, '""')}"`,
                    memberCount,
                    hasUrl ? group.url : ''
                ]);
            });
        } else {
            // ×¤×•×¡×˜ ×œ×œ× ×§×‘×•×¦×•×ª
            const postTitle = post.postTitle || post.title || '×œ×œ× ×›×•×ª×¨×ª';
            const publishTime = formatTimeDisplay(post.publishTime || '');
            
            rows.push([
                post.publishDate || '',
                publishTime,
                `"${postTitle.replace(/"/g, '""')}"`,
                '',
                '×œ×œ× ×§×‘×•×¦×•×ª',
                '×œ× ×¨×œ×•×•× ×˜×™',
                ''
            ]);
        }
    });
    
    // ××™×•×Ÿ ×œ×¤×™ ×ª××¨×™×š ×•×©×¢×” (×”×—×“×©×™× ×‘×™×•×ª×¨ ×‘×¨××©)
    rows.sort((a, b) => {
        const dateA = new Date(a[0] + ' ' + a[1]);
        const dateB = new Date(b[0] + ' ' + b[1]);
        return dateB - dateA;
    });
    
    // ×™×¦×™×¨×ª ×ª×•×›×Ÿ CSV ××¢×•×¦×‘ ×›×˜×‘×œ×” ××¡×•×“×¨×ª
    const csvLines = [];
    
    // ×”×•×¡×¤×ª ×›×•×ª×¨×ª ××¢×•×¦×‘×ª
    csvLines.push('"=== ×“×•×´×— ×¤×¨×¡×•××™× - × ×ª×•× ×™ ×™×™×¦×•× ==="');
    csvLines.push('"×ª××¨×™×š ×™×¦×™×¨×”: ' + new Date().toLocaleDateString('he-IL') + ' ×‘×©×¢×” ' + new Date().toLocaleTimeString('he-IL') + '"');
    csvLines.push('"×¡×”×´×› ×¤×¨×¡×•××™×: ' + rows.length + '"');
    csvLines.push(''); // ×©×•×¨×” ×¨×™×§×”
    
    // ×”×•×¡×¤×ª ×›×•×ª×¨×•×ª ×”×¢××•×“×•×ª ××¢×•×¦×‘×•×ª
    csvLines.push(headers.map(h => `"${h}"`).join(','));
    csvLines.push('"' + '='.repeat(15) + '","' + '='.repeat(12) + '","' + '='.repeat(40) + '","' + '='.repeat(35) + '","' + '='.repeat(25) + '","' + '='.repeat(15) + '","' + '='.repeat(35) + '"');
    
    // ×”×•×¡×¤×ª ×©×•×¨×•×ª ×”× ×ª×•× ×™×
    rows.forEach((row, index) => {
        csvLines.push(row.join(','));
    });
    
    // ×”×•×¡×¤×ª ×¡×™×›×•× ××¢×•×¦×‘ ×‘×¡×•×£
    csvLines.push('');
    csvLines.push('"' + '='.repeat(15) + '","' + '='.repeat(12) + '","' + '='.repeat(40) + '","' + '='.repeat(35) + '","' + '='.repeat(25) + '","' + '='.repeat(15) + '","' + '='.repeat(35) + '"');
    csvLines.push('"×¡×™×›×•×","","","","","",""');
    csvLines.push('"×¡×”×´×› ×¤×¨×¡×•××™×: ' + rows.length + '","","","","","",""');
    csvLines.push('"×¢××•×“×ª ×—×‘×¨×™×: ××¡×¤×¨ ×”×—×‘×¨×™× ×‘×›×œ ×§×‘×•×¦×”","","","","","",""');
    csvLines.push('"× ×•×¦×¨ ×¢×œ ×™×“×™ ××¢×¨×›×ª Postify","","","","","",""');
    
    // ×”×•×¡×¤×ª BOM ×œ×ª××™×›×” ×‘×¢×‘×¨×™×ª
    const BOM = '\uFEFF';
    return BOM + csvLines.join('\n');
}

// ×”×•×¨×“×ª ×§×•×‘×¥ CSV
function downloadCSV(csvContent, filename) {
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    
    if (link.download !== undefined) {
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', filename);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    } else {
        // Fallback for older browsers
        window.open('data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent));
    }
}

// ×¡×’×™×¨×ª ×”×¤×•×¤××¤ ×‘×œ×—×™×¦×” ×¢×œ ×”×¨×§×¢
document.addEventListener('click', function(e) {
    if (e.target.id === 'export-overlay') {
        closeExportDialog();
    }
});

// ===== ×¤×•× ×§×¦×™×•×ª ×˜×‘×œ×” ××¡×•×“×¨×ª =====

let allTableData = []; // ××©×ª× ×” ×’×œ×•×‘×œ×™ ×œ××—×¡×•×Ÿ ×›×œ ×”× ×ª×•× ×™×

// ×¤×ª×™×—×ª ×ª×¦×•×’×ª ×˜×‘×œ×”
async function openTableView() {
    const overlay = document.getElementById('table-overlay');
    overlay.style.display = 'flex';
    
    // ×˜×¢×Ÿ ××ª ×›×œ ×”× ×ª×•× ×™× ×”×§×™×™××™×
    await loadTableData();
    renderTable();
}

// ×¡×’×™×¨×ª ×ª×¦×•×’×ª ×˜×‘×œ×”
function closeTableView() {
    document.getElementById('table-overlay').style.display = 'none';
}

// ×˜×¢×™× ×ª × ×ª×•× ×™× ×œ×˜×‘×œ×”
async function loadTableData() {
    // ×”×©×ª××© ×‘× ×ª×•× ×™× ×”×§×™×™××™× ×ª×—×™×œ×”
    allTableData = [];
    
    if (publishedPosts && publishedPosts.length > 0) {
        publishedPosts.forEach(post => {
            if (post.groups && post.groups.length > 0) {
                post.groups.forEach(group => {
                    allTableData.push(createTableRowData(post, group));
                });
            } else {
                allTableData.push(createTableRowData(post, null));
            }
        });
    }
    
    // ×× ××™×Ÿ × ×ª×•× ×™×, ×˜×¢×Ÿ ××”×©×¨×ª
    if (allTableData.length === 0) {
        const selectedDate = document.getElementById('date-filter').value || new Date().toISOString().split('T')[0];
        const posts = await loadSingleDateData(selectedDate);
        
        posts.forEach(post => {
            if (post.groups && post.groups.length > 0) {
                post.groups.forEach(group => {
                    allTableData.push(createTableRowData(post, group));
                });
            } else {
                allTableData.push(createTableRowData(post, null));
            }
        });
    }
    
    console.log('ğŸ“Š × ×˜×¢× ×• ×œ×˜×‘×œ×”:', allTableData.length, '×©×•×¨×•×ª');
}

// ×™×¦×™×¨×ª × ×ª×•× ×™ ×©×•×¨×” ×œ×˜×‘×œ×”
function createTableRowData(post, group) {
    const hasUrl = group && group.url && group.url !== '#' && group.url !== '';
    const postTitle = post.postTitle || post.title || '×œ×œ× ×›×•×ª×¨×ª';
    const publishTime = formatTimeDisplay((group && group.publishTime) || post.publishTime || '');
    
    // × ×™×§×•×™ ×©× ×”×§×‘×•×¦×”
    let cleanedGroupName = '×œ×œ× ×§×‘×•×¦×•×ª';
    let groupLink = '';
    
    if (group) {
        cleanedGroupName = cleanGroupNameForTable(group.name);
        
        // ×—×™×œ×•×¥ ×œ×™× ×§ ×œ×§×‘×•×¦×”
        if (hasUrl) {
            try {
                const url = new URL(group.url);
                if (url.hostname.includes('facebook.com')) {
                    const pathParts = url.pathname.split('/');
                    const groupsIndex = pathParts.findIndex(part => part === 'groups');
                    if (groupsIndex !== -1 && groupsIndex + 1 < pathParts.length) {
                        const groupId = pathParts[groupsIndex + 1];
                        groupLink = `https://www.facebook.com/groups/${groupId}`;
                    }
                }
            } catch (e) {
                console.warn('×œ× × ×™×ª×Ÿ ×œ×—×œ×¥ ×œ×™× ×§ ×§×‘×•×¦×”:', group.url);
            }
        }
    }
    
    return {
        date: post.publishDate || '',
        time: publishTime,
        title: postTitle,
        groupName: cleanedGroupName,
        status: hasUrl ? 'success' : 'failed',
        statusText: hasUrl ? '×”×¦×œ×—×”' : '×›×™×©×œ×•×Ÿ',
        postUrl: hasUrl ? group.url : '',
        groupUrl: groupLink
    };
}

// × ×™×§×•×™ ×©× ×§×‘×•×¦×” ×œ×˜×‘×œ×”
function cleanGroupNameForTable(name) {
    if (!name) return '';
    
    let cleaned = name.replace(/\s*\(\d+\)\s*/g, '').trim();
    cleaned = cleaned.replace(/\s*facebook\s*$/i, '').trim();
    cleaned = cleaned.replace(/^facebook\s*/i, '').trim();
    cleaned = cleaned.replace(/[\|\-\â€“\â€”]\s*facebook/i, '').trim();
    cleaned = cleaned.replace(/facebook\s*[\|\-\â€“\â€”]/i, '').trim();
    cleaned = cleaned.replace(/\|/g, '').trim();
    cleaned = cleaned.replace(/\s+/g, ' ').trim();
    
    return cleaned;
}

// ×¨×™× ×“×•×¨ ×”×˜×‘×œ×”
function renderTable(filteredData = null) {
    const tableBody = document.getElementById('table-body');
    const dataToRender = filteredData || allTableData;
    
    // ××™×•×Ÿ ×œ×¤×™ ×ª××¨×™×š ×•×©×¢×”
    dataToRender.sort((a, b) => {
        const dateA = new Date(a.date + ' ' + a.time);
        const dateB = new Date(b.date + ' ' + b.time);
        return dateB - dateA;
    });
    
    let html = '';
    let lastDate = '';
    
    dataToRender.forEach((row, index) => {
        // ×”×•×¡×¤×ª ××¤×¨×™×“ ×‘×™×Ÿ ×ª××¨×™×›×™×
        if (row.date !== lastDate) {
            if (lastDate !== '') {
                html += `<tr class="date-separator"><td colspan="7">ğŸ“… ${formatDateHebrew(row.date)}</td></tr>`;
            }
            lastDate = row.date;
        }
        
        html += `
            <tr>
                <td>${row.date}</td>
                <td>${row.time}</td>
                <td style="text-align: right; max-width: 200px; word-wrap: break-word;">${escapeHtml(row.title)}</td>
                <td style="text-align: right;">${escapeHtml(row.groupName)}</td>
                <td>
                    <span class="status-${row.status}-table">${row.statusText}</span>
                </td>
                <td>
                    ${row.postUrl ? `<a href="${row.postUrl}" target="_blank" class="table-link">ğŸ”— ×¦×¤×”</a>` : 'âŒ'}
                </td>
                <td>
                    ${row.groupUrl ? `<a href="${row.groupUrl}" target="_blank" class="table-link">ğŸ‘¥ ×§×‘×•×¦×”</a>` : 'âŒ'}
                </td>
            </tr>
        `;
    });
    
    tableBody.innerHTML = html;
    updateTableStats(dataToRender);
}

// ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª ×”×˜×‘×œ×”
function updateTableStats(data) {
    const statsDiv = document.getElementById('table-stats');
    const total = data.length;
    const successful = data.filter(row => row.status === 'success').length;
    const failed = data.filter(row => row.status === 'failed').length;
    
    statsDiv.innerHTML = `
        ğŸ“Š ×¡×”"×›: ${total} ×¤×¨×¡×•××™× | 
        âœ… ×”×¦×œ×™×—×•: ${successful} | 
        âŒ × ×›×©×œ×•: ${failed} |
        ğŸ“ˆ ××—×•×– ×”×¦×œ×—×”: ${total > 0 ? Math.round((successful / total) * 100) : 0}%
    `;
}

// ×¡×™× ×•×Ÿ ×”×˜×‘×œ×”
function filterTable() {
    const titleFilter = document.getElementById('filter-title').value.toLowerCase();
    const groupFilter = document.getElementById('filter-group').value.toLowerCase();
    const dateFilter = document.getElementById('filter-date').value;
    const statusFilter = document.getElementById('filter-status').value;
    
    const filteredData = allTableData.filter(row => {
        const titleMatch = !titleFilter || row.title.toLowerCase().includes(titleFilter);
        const groupMatch = !groupFilter || row.groupName.toLowerCase().includes(groupFilter);
        const dateMatch = !dateFilter || row.date === dateFilter;
        const statusMatch = !statusFilter || row.status === statusFilter;
        
        return titleMatch && groupMatch && dateMatch && statusMatch;
    });
    
    renderTable(filteredData);
}

// × ×™×§×•×™ ××¡× × ×™×
function clearTableFilters() {
    document.getElementById('filter-title').value = '';
    document.getElementById('filter-group').value = '';
    document.getElementById('filter-date').value = '';
    document.getElementById('filter-status').value = '';
    
    renderTable();
}

// ×¤×•×¨××˜ ×ª××¨×™×š ×œ×¢×‘×¨×™×ª
function formatDateHebrew(dateStr) {
    try {
        const date = new Date(dateStr);
        return date.toLocaleDateString('he-IL', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    } catch (e) {
        return dateStr;
    }
}

// ×¡×’×™×¨×ª ×”×˜×‘×œ×” ×‘×œ×—×™×¦×” ×¢×œ ×”×¨×§×¢
document.addEventListener('click', function(e) {
    if (e.target.id === 'table-overlay') {
        closeTableView();
    }
});

// ===== ×¡×•×£ ×¤×•× ×§×¦×™×•×ª ×˜×‘×œ×” =====

// ===== ×¡×•×£ ×¤×•× ×§×¦×™×•×ª ×™×™×¦×•× =====
</script>

<div class="published-container">
    <div class="header-section">
        <h1 class="page-title">
            ğŸ“‹ ×“×•"×— ×¤×¨×¡×•× ×™×•××™
        </h1>
        
        <div class="controls-section">
            <div class="date-filter">
                <label for="date-filter">×‘×—×¨ ×ª××¨×™×š:</label>
                <input type="date" id="date-filter" onchange="onDateChange()">
            </div>
            <button class="refresh-btn" onclick="refreshPosts()">
                ğŸ”„ ×¨×¢× ×Ÿ
            </button>
            <button class="export-btn" onclick="openExportDialog()">
                ğŸ“Š ×™×™×¦× × ×ª×•× ×™ ×¤×¨×¡×•×
            </button>
            <button class="table-view-btn" onclick="openTableView()">
                ğŸ“‹ ×”×¦×’ ×›×˜×‘×œ×”
            </button>
        </div>
    </div>
    
    <div class="stats-section">
        <div class="stat-card today">
            <div class="stat-number" id="today-count">0</div>
            <div class="stat-label">×¤×¨×¡×•××™× ×”×™×•×</div>
        </div>
        
        <div class="stat-card total">
            <div class="stat-number" id="week-count">0</div>
            <div class="stat-label">×¤×¨×¡×•××™× ××ª×—×™×œ×ª ×”×©×‘×•×¢</div>
        </div>
        
        <div class="stat-card groups">
            <div class="stat-number" id="month-count">0</div>
            <div class="stat-label">×¤×¨×¡×•××™× ××ª×—×™×œ×ª ×”×—×•×“×©</div>
        </div>
    </div>
    
    <div id="loading" class="loading-spinner" style="display: none;">
        <div class="loading-icon">â³</div>
        <div class="loading-text" id="loading-text">×˜×•×¢×Ÿ ×¤×¨×¡×•××™×<span class="loading-dots"></span></div>
        <div class="loading-progress" id="loading-details" style="font-size: 0.9em; margin-top: 8px;">×× × ×”××ª×Ÿ, ×”× ×ª×•× ×™× × ×˜×¢× ×™× ××”×©×¨×ª</div>
    </div>
    
    <div id="error-container" style="display: none;"></div>
    
    <div id="posts-container" class="posts-list">
        <!-- ×”×¤×¨×¡×•××™× ×™×•×¦×’×• ×›××Ÿ -->
    </div>
</div>

<!-- ×¤×•×¤××¤ ×™×™×¦×•× × ×ª×•× ×™× -->
<div id="export-overlay" class="export-overlay">
    <div class="export-dialog">
        <div class="export-header">
            ğŸ“Š ×™×™×¦×•× × ×ª×•× ×™ ×¤×¨×¡×•×
        </div>
        
        <div class="export-options">
            <div class="export-option" onclick="selectExportOption('custom')">
                <input type="radio" name="export-period" value="custom" id="custom-range">
                <label for="custom-range">ğŸ—“ï¸ ×˜×•×•×— ×ª××¨×™×›×™× ××•×ª×× ××™×©×™×ª</label>
            </div>
            <div class="date-range-inputs" id="custom-date-inputs">
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <label>××ª××¨×™×š:</label>
                        <input type="date" id="export-start-date">
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <label>×¢×“ ×ª××¨×™×š:</label>
                        <input type="date" id="export-end-date">
                    </div>
                </div>
            </div>
            
            <div class="export-option" onclick="selectExportOption('last-month')">
                <input type="radio" name="export-period" value="last-month" id="last-month">
                <label for="last-month">ğŸ“… ×”×—×•×“×© ×”× ×•×›×—×™</label>
            </div>
            
            <div class="export-option" onclick="selectExportOption('current-month')">
                <input type="radio" name="export-period" value="current-month" id="current-month">
                <label for="current-month">ğŸ“† ×—×•×“×© ×©×¢×‘×¨</label>
            </div>
            
            <div class="export-option" onclick="selectExportOption('all-time')">
                <input type="radio" name="export-period" value="all-time" id="all-time">
                <label for="all-time">ğŸŒ ×›×œ ×”× ×ª×•× ×™× (×××– ×•××ª××™×“)</label>
            </div>
        </div>
        
        <div class="export-loading" id="export-loading">
            <div class="export-loading-icon">â³</div>
            <div>××›×™×Ÿ ×§×•×‘×¥ CSV... ×× × ×”××ª×Ÿ</div>
        </div>
        
        <div class="export-actions" id="export-actions">
            <button class="export-action-btn export-confirm" onclick="executeExport()">
                ğŸ“¥ ×™×™×¦× × ×ª×•× ×™×
            </button>
            <button class="export-action-btn export-cancel" onclick="closeExportDialog()">
                âŒ ×‘×™×˜×•×œ
            </button>
        </div>
    </div>
</div>

<!-- ×˜×‘×œ×” ××¡×•×“×¨×ª -->
<div id="table-overlay" class="table-overlay">
    <div class="table-dialog">
        <div class="table-header">
            <h2 class="table-title">ğŸ“‹ ×˜×‘×œ×ª ×¤×¨×¡×•××™× ××¡×•×“×¨×ª</h2>
            <button class="table-close-btn" onclick="closeTableView()">âœ•</button>
        </div>
        
        <div class="table-filters">
            <div class="filter-group">
                <label>×—×™×¤×•×© ×›×•×ª×¨×ª:</label>
                <input type="text" id="filter-title" placeholder="×”×§×œ×“ ×œ×—×™×¤×•×©..." onkeyup="filterTable()">
            </div>
            
            <div class="filter-group">
                <label>×—×™×¤×•×© ×§×‘×•×¦×”:</label>
                <input type="text" id="filter-group" placeholder="×©× ×§×‘×•×¦×”..." onkeyup="filterTable()">
            </div>
            
            <div class="filter-group">
                <label>×ª××¨×™×š:</label>
                <input type="date" id="filter-date" onchange="filterTable()">
            </div>
            
            <div class="filter-group">
                <label>×¡×˜×˜×•×¡:</label>
                <select id="filter-status" onchange="filterTable()">
                    <option value="">×”×›×œ</option>
                    <option value="success">×”×¦×œ×—×”</option>
                    <option value="failed">×›×™×©×œ×•×Ÿ</option>
                </select>
            </div>
            
            <button class="clear-filters-btn" onclick="clearTableFilters()">
                ğŸ—‘ï¸ × ×§×” ××¡× × ×™×
            </button>
        </div>
        
        <div class="table-container">
            <table class="data-table" id="posts-table">
                <thead>
                    <tr>
                        <th>×ª××¨×™×š</th>
                        <th>×©×¢×”</th>
                        <th>×›×•×ª×¨×ª ×”×¤×•×¡×˜</th>
                        <th>×©× ×”×§×‘×•×¦×”</th>
                        <th>×¡×˜×˜×•×¡</th>
                        <th>×œ×™× ×§ ×œ×¤×¨×¡×•×</th>
                        <th>×œ×™× ×§ ×œ×§×‘×•×¦×”</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- ×”× ×ª×•× ×™× ×™×•×›× ×¡×• ×›××Ÿ -->
                </tbody>
            </table>
        </div>
        
        <div class="table-stats" id="table-stats">
            <!-- ×¡×˜×˜×™×¡×˜×™×§×•×ª ×™×•×¦×’×• ×›××Ÿ -->
        </div>
    </div>
</div>

</body>
</html>
